<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.3"/>
    <title>microns_datacleaner API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#d8d8d8;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:0.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1{font-weight:500;font-size:2.5rem;margin:.3em 0;padding:.2em 0;}.pdoc h2{font-weight:500;font-size:2rem;margin:.3em 0;padding:.2em 0;}.pdoc h3{font-weight:300;font-size:2rem;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.0rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.0rem;background-color:rgb(238, 238, 238);font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.0rem;font-weight:300;}.pdoc > section:not(.module-info) h4{font-size:1.0rem;}.pdoc > section:not(.module-info) h5{font-size:1.0rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);font-size:1em;overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#microns-datacleaner-docs">MICrONS DataCleaner Docs</a>
  <ul>
    <li><a href="#install">Install 📥</a></li>
    <li><a href="#quick-start">Quick Start ⏩</a></li>
    <li><a href="#license-and-citation-policy">License and citation policy 📚</a></li>
    <li><a href="#building-the-docs">Building the docs 📜</a></li>
  </ul></li>
</ul>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="microns_datacleaner/filters.html">filters</a></li>
                    <li><a href="microns_datacleaner/remapper.html">remapper</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#MicronsDataCleaner">MicronsDataCleaner</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MicronsDataCleaner.__init__">MicronsDataCleaner</a>
                        </li>
                        <li>
                                <a class="variable" href="#MicronsDataCleaner.homedir">homedir</a>
                        </li>
                        <li>
                                <a class="variable" href="#MicronsDataCleaner.datadir">datadir</a>
                        </li>
                        <li>
                                <a class="variable" href="#MicronsDataCleaner.version">version</a>
                        </li>
                        <li>
                                <a class="variable" href="#MicronsDataCleaner.data_storage">data_storage</a>
                        </li>
                        <li>
                                <a class="function" href="#MicronsDataCleaner.download_functional_fits">download_functional_fits</a>
                        </li>
                        <li>
                                <a class="function" href="#MicronsDataCleaner.get_table_list">get_table_list</a>
                        </li>
                        <li>
                                <a class="function" href="#MicronsDataCleaner.read_table">read_table</a>
                        </li>
                        <li>
                                <a class="function" href="#MicronsDataCleaner.download_nucleus_data">download_nucleus_data</a>
                        </li>
                        <li>
                                <a class="function" href="#MicronsDataCleaner.download_tables">download_tables</a>
                        </li>
                        <li>
                                <a class="function" href="#MicronsDataCleaner.download_synapse_data">download_synapse_data</a>
                        </li>
                        <li>
                                <a class="function" href="#MicronsDataCleaner.merge_synapses">merge_synapses</a>
                        </li>
                        <li>
                                <a class="function" href="#MicronsDataCleaner.merge_table">merge_table</a>
                        </li>
                        <li>
                                <a class="function" href="#MicronsDataCleaner.process_nucleus_data">process_nucleus_data</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
microns_datacleaner    </h1>

                        <div class="docstring"><h1 id="microns-datacleaner-docs">MICrONS DataCleaner Docs</h1>

<p>This webpage contains all the documentation for the <a href="https://github.com/margheritapremi/MICrONS-datacleaner">MICrONS DataCleaner</a> pakcage. </p>

<h2 id="install">Install 📥</h2>

<p>You can install the package from PyPi via </p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">pip</span> <span class="n">install</span> <span class="n">microns</span><span class="o">-</span><span class="n">datacleaner</span>
</code></pre>
</div>

<h2 id="quick-start">Quick Start ⏩</h2>

<p>For more detailed code, you can also check out the <code>basic_tutorial.ipynb</code> notebook inside <code>tutorial</code>.</p>

<h3 id="download-nucleus-information">Download nucleus information</h3>

<p>The package is initiated by importing and generating an instance of the class, where you specify the <code>datadir</code> folder (where data will be downloaded), the <code>version</code> of the data you intend to download (see the <a href="https://www.microns-explorer.org/manifests">data releases</a>).</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1">#Import the lib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">microns_datacleaner</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mic</span>

<span class="c1">#Target version and download folder</span>
<span class="n">cleaner</span> <span class="o">=</span> <span class="n">mic</span><span class="o">.</span><span class="n">MicronsDataCleaner</span><span class="p">(</span><span class="n">datadir</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1300</span><span class="p">,</span> <span class="n">download_policy</span><span class="o">=</span><span class="s1">&#39;minimum&#39;</span><span class="p">)</span> 

<span class="c1">#Download the data</span>
<span class="n">cleaner</span><span class="o">.</span><span class="n">download_nucleus_data</span><span class="p">()</span>
</code></pre>
</div>

<p>The <code>download_policy</code> stablishes which tables to be downloaded (see API below for details). The default mode, <code>minimum</code>, downloads only the tables which are required to build the unit table generated by the package.</p>

<p>The tables needs to be downloaded <strong>only once</strong>. They will be downloaded in <code>datadir/version/raw</code>. In this way, if you change the <code>version</code>, the tables will not be mixed, allowing for more replicable analyses.</p>

<p>Once the data is downloaded, the unit table can be constructed as </p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">units</span><span class="p">,</span> <span class="n">segments</span> <span class="o">=</span> <span class="n">cleaner</span><span class="o">.</span><span class="n">process_nucleus_data</span><span class="p">(</span><span class="n">functional_data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre>
</div>

<p>The <code>segments</code> variable is a table with the resulting segmentation of the layers. The <code>units</code> includes all the information about the units. The package includes the information for all AIBS classified units. The position is already transformed into pial coordinates, with Y being the depth. Observe that the table includes also nonneuronal objects.</p>

<p>The raw dataset contains objects with duplicated <code>pt_root_id</code>, that can be overmerged objects, including fraction of an axon, spine head, or multisoma object. For this reason, the package works always with the <code>nucleus_id</code> when merging the tables. All objects that present more than <code>pt_root_id</code> are eliminated: it is not that _the duplicates_ are eliminates, but _all the objects_ that presented a duplicate. The <code>units</code> variable has unique <code>nucleus_id</code> and <code>pt_root_id</code>.</p>

<p>The flag <code>functional_data</code> allows for several options to integrate information from the functional dataset (see details in the API). In particular, it can add manually coregistrated <code>session</code>, <code>scan_idx</code> and <code>unit_id</code> in order to match the connectomics with the functional data. </p>

<p>Finally, you might want to merge some information in the unit table that is not present but can be found in other annotation tables. The available tables can be easily obtained and downloaded with</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">cleaner</span><span class="o">.</span><span class="n">get_table_list</span><span class="p">()</span>

<span class="c1">#Example download of the automatic coregistration</span>
<span class="n">cleaner</span><span class="o">.</span><span class="n">download_tables</span><span class="p">([</span><span class="s1">&#39;coregistration_auto_phase3_fwd_apl_vess_combined_v2&#39;</span><span class="p">])</span>
</code></pre>
</div>

<p>The tables can be easily merged with the unit table using the convenience function <code>merge_columns</code>. Please refer to the <code>basic_tutorial</code> notebook for more examples.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">auto_coreg</span> <span class="o">=</span> <span class="n">cleaner</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s2">&quot;coregistration_auto_phase3_fwd_apl_vess_combined_v2&quot;</span><span class="p">)</span>

<span class="c1">#Add the columns from the auto_coreg table to our unit table</span>
<span class="n">units</span> <span class="o">=</span> <span class="n">cleaner</span><span class="o">.</span><span class="n">merge_table</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">auto_coreg</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_idx&#39;</span><span class="p">,</span> <span class="s1">&#39;unit_id&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">])</span>
</code></pre>
</div>

<h3 id="download-synapses">Download synapses</h3>

<p>The synapse table is too large to be downloaded entirely. For this reason, one needs to query the dataset with the desired subset of pre and post-synaptic neurons. This can be done only by specifying the <code>pt_root_id</code> of the desired units. One these have been selected, the synapses can be downloaded with    </p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1">#All presynaptic inputs to a random sample of units </span>
<span class="n">postids</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="s1">&#39;pt_root_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">preids</span>  <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="s1">&#39;pt_root_id&#39;</span><span class="p">]</span>
<span class="n">cleaner</span><span class="o">.</span><span class="n">download_synapse_data</span><span class="p">(</span><span class="n">preids</span><span class="p">,</span> <span class="n">postids</span><span class="p">)</span>
</code></pre>
</div>

<p>The <code>download_synapse_data</code> function allows to download the data in chunks of neurons of predefined size. In this way, if the server connection fails, part of the data was already written to file and download can re-start from where it was left. If a problem occurs, the function will retry automatically. Parameters such as the maximum number of trials before giving up, time between trials or download chunk size can be set. </p>

<p>By default, <code>download_synapse_data</code> collapses all synapses between two units to a single effective connection. The synaptic size is the sum all of synapses found between the two units. By setting <code>drop_synapses_duplicates = False</code> one can retrieve all the individual synapses, as well as their position.  </p>

<p>Once all the chunks have been loaded, they need to be manually merged, indicating the name of the desired synapse table. </p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">cleaner</span><span class="o">.</span><span class="n">merge_synapses</span><span class="p">(</span><span class="n">syn_table_name</span><span class="o">=</span><span class="s2">&quot;example_merged_synapses&quot;</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="filtering">Filtering</h3>

<p>The package includes a submodule <code>mic_datacleaner.filters</code> in order to easily query the constructed unit and connections tables. The function <code>fl.filter_neurons</code> can be used to subset neurons by several conditions at the same time:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1">#All neurons that (1) are in area V1 (2) have proofread axons (3) are either in L2/3 or L4 </span>
<span class="n">units_filter</span> <span class="o">=</span> <span class="n">fl</span><span class="o">.</span><span class="n">filter_neurons</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;L2/3&#39;</span><span class="p">,</span> <span class="s1">&#39;L4&#39;</span><span class="p">],</span> <span class="n">proofread</span><span class="o">=</span><span class="s1">&#39;ax_clean&#39;</span><span class="p">,</span> <span class="n">brain_area</span><span class="o">=</span><span class="s1">&#39;V1&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p>More examples can be found on the <code>basic_tutorial</code> notebook. The synapses can be also filtered, </p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1">#All synapses with </span>
<span class="c1"># - presynaptic neurons in V1 with axons clean</span>
<span class="c1"># - postsynaptic neurons in either RL, AL or LM</span>
<span class="n">syn_filter</span> <span class="o">=</span> <span class="n">fl</span><span class="o">.</span><span class="n">filter_connections</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">synapses</span><span class="p">,</span>  <span class="n">brain_area</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;V1&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;RL&#39;</span><span class="p">,</span> <span class="s1">&#39;AL&#39;</span><span class="p">,</span> <span class="s1">&#39;LM&#39;</span><span class="p">]],</span> <span class="n">proofread</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ax_clean&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span> 
</code></pre>
</div>

<p>or just by directly indicating the ids of the pre and post synaptic neurons that we want </p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">syn_filter</span> <span class="o">=</span> <span class="n">fl</span><span class="o">.</span><span class="n">synapses_by_id</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">synapses</span><span class="p">,</span> <span class="n">pre_ids</span><span class="o">=</span><span class="n">units_filter</span><span class="p">[</span><span class="s1">&#39;pt_root_id&#39;</span><span class="p">],</span> <span class="n">post_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> 
</code></pre>
</div>

<p>Please read the API documentation for filters to find our more.</p>

<h3 id="remapping">Remapping</h3>

<p>When working with functional data and tunign curves it is useful to obtain the rates as a matrix to efficiently compute currents. This needs a remapping of the <code>pt_root_id</code>. Please check out the <code>basic_tutorial</code> notebook or the <code>remapper</code> subpackage docs to find out more.</p>

<h2 id="license-and-citation-policy">License and citation policy 📚</h2>

<p>The code is shared under a license. When using our package, please consider citing it appropiately.</p>

<p>The data is downloaded from the <a href="https://www.microns-explorer.org/">MICrONS Project</a> directly. Therefore, please follow also the <a href="https://www.microns-explorer.org/citation-policy">license and citation policy of the MICrONS dataset</a>. </p>

<p>The repositories from which the data is extracted are </p>

<ol>
<li><a href="https://doi.org/10.60533/BOSS-2021-T0SY">IARPA MICrONS Minnie Project</a> </li>
<li><a href="https://github.com/cajal/microns_phase3_nda">Microns Phase 3 NDA</a>. </li>
</ol>

<p>To construct the tables the package downloads results derived from the following papers of the MICrONS collaboration: </p>

<ol>
<li><a href="https://doi.org/10.1038/s41586-025-08790-w">Functional connectomics spanning multiple areas of mouse visual cortex</a>. The Microns Consortium. 2025 </li>
<li><a href="https://doi.org/10.1038/s41586-025-08829-y">Foundation model of neural activity predicts response to new stimulus types</a></li>
<li><a href="http://doi.org/10.1038/s41586-024-07765-7">Perisomatic ultrastructure efficiently classifies cells in mouse cortex</a></li>
<li><a href="https://doi.org/">NEURD offers automated proofreading and feature extraction for connectomics</a></li>
<li><a href="https://doi.org/10.1038/s41592-024-02426-z">CAVE: Connectome Annotation Versioning Engine</a></li>
</ol>

<h2 id="building-the-docs">Building the docs 📜</h2>

<p>To generate these docs locally in your computer, you need <a href="https://pdoc.dev/">pdoc</a>. Then, fromn the root directory of the repository, run</p>

<pre><code>pdoc -t docs/template src/microns_datacleaner/ -o docs/html
</code></pre>

<p>The docs will be generated in the <code>docs/html</code> folder in HTML format, which can be checked with the browser. You can also get docs for individual just using <code>src/filename.py</code>.</p>
</div>

            </section>
            <hr>
            <h2 id='api-documentation'> API Documentation </h2>
                <section id="MicronsDataCleaner">
                            <input id="MicronsDataCleaner-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MicronsDataCleaner</span>:

                <label class="view-source-button" for="MicronsDataCleaner-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MicronsDataCleaner"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MicronsDataCleaner-15"><a href="#MicronsDataCleaner-15"><span class="linenos"> 15</span></a><span class="k">class</span><span class="w"> </span><span class="nc">MicronsDataCleaner</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-16"><a href="#MicronsDataCleaner-16"><span class="linenos"> 16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-17"><a href="#MicronsDataCleaner-17"><span class="linenos"> 17</span></a><span class="sd">    The main class to download and clean data from the Microns Dataset. </span>
</span><span id="MicronsDataCleaner-18"><a href="#MicronsDataCleaner-18"><span class="linenos"> 18</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-19"><a href="#MicronsDataCleaner-19"><span class="linenos"> 19</span></a>
</span><span id="MicronsDataCleaner-20"><a href="#MicronsDataCleaner-20"><span class="linenos"> 20</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-21"><a href="#MicronsDataCleaner-21"><span class="linenos"> 21</span></a><span class="sd">    Path where the code is executed</span>
</span><span id="MicronsDataCleaner-22"><a href="#MicronsDataCleaner-22"><span class="linenos"> 22</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-23"><a href="#MicronsDataCleaner-23"><span class="linenos"> 23</span></a>    <span class="n">homedir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> 
</span><span id="MicronsDataCleaner-24"><a href="#MicronsDataCleaner-24"><span class="linenos"> 24</span></a>
</span><span id="MicronsDataCleaner-25"><a href="#MicronsDataCleaner-25"><span class="linenos"> 25</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-26"><a href="#MicronsDataCleaner-26"><span class="linenos"> 26</span></a><span class="sd">    Subfolder aimed to contain the downloaded data</span>
</span><span id="MicronsDataCleaner-27"><a href="#MicronsDataCleaner-27"><span class="linenos"> 27</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-28"><a href="#MicronsDataCleaner-28"><span class="linenos"> 28</span></a>    <span class="n">datadir</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span> 
</span><span id="MicronsDataCleaner-29"><a href="#MicronsDataCleaner-29"><span class="linenos"> 29</span></a>
</span><span id="MicronsDataCleaner-30"><a href="#MicronsDataCleaner-30"><span class="linenos"> 30</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-31"><a href="#MicronsDataCleaner-31"><span class="linenos"> 31</span></a><span class="sd">    Version of the client we are using</span>
</span><span id="MicronsDataCleaner-32"><a href="#MicronsDataCleaner-32"><span class="linenos"> 32</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-33"><a href="#MicronsDataCleaner-33"><span class="linenos"> 33</span></a>    <span class="n">version</span> <span class="o">=</span> <span class="mi">1300</span>
</span><span id="MicronsDataCleaner-34"><a href="#MicronsDataCleaner-34"><span class="linenos"> 34</span></a>
</span><span id="MicronsDataCleaner-35"><a href="#MicronsDataCleaner-35"><span class="linenos"> 35</span></a>
</span><span id="MicronsDataCleaner-36"><a href="#MicronsDataCleaner-36"><span class="linenos"> 36</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1300</span><span class="p">,</span> <span class="n">download_policy</span><span class="o">=</span><span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="n">extra_tables</span><span class="o">=</span><span class="p">[]):</span>
</span><span id="MicronsDataCleaner-37"><a href="#MicronsDataCleaner-37"><span class="linenos"> 37</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-38"><a href="#MicronsDataCleaner-38"><span class="linenos"> 38</span></a><span class="sd">        Initialize the class and makes sure subfolders to download exist. Configures the tables to be downloaded (except synapses) via</span>
</span><span id="MicronsDataCleaner-39"><a href="#MicronsDataCleaner-39"><span class="linenos"> 39</span></a><span class="sd">        a download policy.</span>
</span><span id="MicronsDataCleaner-40"><a href="#MicronsDataCleaner-40"><span class="linenos"> 40</span></a>
</span><span id="MicronsDataCleaner-41"><a href="#MicronsDataCleaner-41"><span class="linenos"> 41</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner-42"><a href="#MicronsDataCleaner-42"><span class="linenos"> 42</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner-43"><a href="#MicronsDataCleaner-43"><span class="linenos"> 43</span></a><span class="sd">            datadir: string, optional</span>
</span><span id="MicronsDataCleaner-44"><a href="#MicronsDataCleaner-44"><span class="linenos"> 44</span></a><span class="sd">                Defaults to &#39;data&#39;. Points to the folder where information will be downloaded.</span>
</span><span id="MicronsDataCleaner-45"><a href="#MicronsDataCleaner-45"><span class="linenos"> 45</span></a><span class="sd">            custom_tables: dict, optional </span>
</span><span id="MicronsDataCleaner-46"><a href="#MicronsDataCleaner-46"><span class="linenos"> 46</span></a><span class="sd">                Used to override the default tables used to construct the unit table in a given version. The keys for the tables</span>
</span><span id="MicronsDataCleaner-47"><a href="#MicronsDataCleaner-47"><span class="linenos"> 47</span></a><span class="sd">                to be overrided are &#39;celltype&#39; for the nucleus classification scheme, &#39;proofreading&#39; for the prooreading table,</span>
</span><span id="MicronsDataCleaner-48"><a href="#MicronsDataCleaner-48"><span class="linenos"> 48</span></a><span class="sd">                &#39;brain_areas&#39; for assigned brain areas, &#39;func_props&#39; for functional properties, and &#39;coreg&#39; for the coregistration table.</span>
</span><span id="MicronsDataCleaner-49"><a href="#MicronsDataCleaner-49"><span class="linenos"> 49</span></a><span class="sd">            download_policy: str, optional</span>
</span><span id="MicronsDataCleaner-50"><a href="#MicronsDataCleaner-50"><span class="linenos"> 50</span></a><span class="sd">                Used to set how the tables should be downloaded. &#39;minimum&#39; (the default) only downloads the minimum amount of tables necessary </span>
</span><span id="MicronsDataCleaner-51"><a href="#MicronsDataCleaner-51"><span class="linenos"> 51</span></a><span class="sd">                to construct our unit table. &#39;all&#39; gets all of them. &#39;extra&#39; gets the same as &#39;minimum&#39; plus the tables specified in `extra_tables`.</span>
</span><span id="MicronsDataCleaner-52"><a href="#MicronsDataCleaner-52"><span class="linenos"> 52</span></a><span class="sd">            extra_tables: list, optional</span>
</span><span id="MicronsDataCleaner-53"><a href="#MicronsDataCleaner-53"><span class="linenos"> 53</span></a><span class="sd">                List of extra table names to be downloaded. See the download_police for more information.</span>
</span><span id="MicronsDataCleaner-54"><a href="#MicronsDataCleaner-54"><span class="linenos"> 54</span></a>
</span><span id="MicronsDataCleaner-55"><a href="#MicronsDataCleaner-55"><span class="linenos"> 55</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner-56"><a href="#MicronsDataCleaner-56"><span class="linenos"> 56</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner-57"><a href="#MicronsDataCleaner-57"><span class="linenos"> 57</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner-58"><a href="#MicronsDataCleaner-58"><span class="linenos"> 58</span></a><span class="sd">                This method is a constructor and does not return any value.</span>
</span><span id="MicronsDataCleaner-59"><a href="#MicronsDataCleaner-59"><span class="linenos"> 59</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-60"><a href="#MicronsDataCleaner-60"><span class="linenos"> 60</span></a>        
</span><span id="MicronsDataCleaner-61"><a href="#MicronsDataCleaner-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
</span><span id="MicronsDataCleaner-62"><a href="#MicronsDataCleaner-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datadir</span> <span class="o">=</span> <span class="n">datadir</span>
</span><span id="MicronsDataCleaner-63"><a href="#MicronsDataCleaner-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">homedir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MicronsDataCleaner-64"><a href="#MicronsDataCleaner-64"><span class="linenos"> 64</span></a>
</span><span id="MicronsDataCleaner-65"><a href="#MicronsDataCleaner-65"><span class="linenos"> 65</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data will be stored in: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-66"><a href="#MicronsDataCleaner-66"><span class="linenos"> 66</span></a>
</span><span id="MicronsDataCleaner-67"><a href="#MicronsDataCleaner-67"><span class="linenos"> 67</span></a>        <span class="c1"># Ensure directories exist</span>
</span><span id="MicronsDataCleaner-68"><a href="#MicronsDataCleaner-68"><span class="linenos"> 68</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-69"><a href="#MicronsDataCleaner-69"><span class="linenos"> 69</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-70"><a href="#MicronsDataCleaner-70"><span class="linenos"> 70</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/synapses&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-71"><a href="#MicronsDataCleaner-71"><span class="linenos"> 71</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Data directories created successfully.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-72"><a href="#MicronsDataCleaner-72"><span class="linenos"> 72</span></a>
</span><span id="MicronsDataCleaner-73"><a href="#MicronsDataCleaner-73"><span class="linenos"> 73</span></a>        <span class="c1"># Initialize the CAVEClient with the user-specified version </span>
</span><span id="MicronsDataCleaner-74"><a href="#MicronsDataCleaner-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_client</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-75"><a href="#MicronsDataCleaner-75"><span class="linenos"> 75</span></a>
</span><span id="MicronsDataCleaner-76"><a href="#MicronsDataCleaner-76"><span class="linenos"> 76</span></a>        <span class="c1"># Set the tables to download according to the version</span>
</span><span id="MicronsDataCleaner-77"><a href="#MicronsDataCleaner-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_configure_download_tables</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">download_policy</span><span class="p">,</span> <span class="n">extra_tables</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-78"><a href="#MicronsDataCleaner-78"><span class="linenos"> 78</span></a>
</span><span id="MicronsDataCleaner-79"><a href="#MicronsDataCleaner-79"><span class="linenos"> 79</span></a>    
</span><span id="MicronsDataCleaner-80"><a href="#MicronsDataCleaner-80"><span class="linenos"> 80</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_configure_download_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">download_policy</span><span class="p">,</span> <span class="n">extra_tables</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-81"><a href="#MicronsDataCleaner-81"><span class="linenos"> 81</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-82"><a href="#MicronsDataCleaner-82"><span class="linenos"> 82</span></a><span class="sd">        Configures the list of tables to be downloaded based on version and policy.</span>
</span><span id="MicronsDataCleaner-83"><a href="#MicronsDataCleaner-83"><span class="linenos"> 83</span></a><span class="sd">        This is an internal helper method called by the constructor.</span>
</span><span id="MicronsDataCleaner-84"><a href="#MicronsDataCleaner-84"><span class="linenos"> 84</span></a><span class="sd">        This method is not intended for direct use by the end-user.</span>
</span><span id="MicronsDataCleaner-85"><a href="#MicronsDataCleaner-85"><span class="linenos"> 85</span></a><span class="sd">    </span>
</span><span id="MicronsDataCleaner-86"><a href="#MicronsDataCleaner-86"><span class="linenos"> 86</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner-87"><a href="#MicronsDataCleaner-87"><span class="linenos"> 87</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner-88"><a href="#MicronsDataCleaner-88"><span class="linenos"> 88</span></a><span class="sd">            version: int</span>
</span><span id="MicronsDataCleaner-89"><a href="#MicronsDataCleaner-89"><span class="linenos"> 89</span></a><span class="sd">                The dataset version, used to select the correct set of default table names.</span>
</span><span id="MicronsDataCleaner-90"><a href="#MicronsDataCleaner-90"><span class="linenos"> 90</span></a><span class="sd">            download_policy : {&#39;minimum&#39;, &#39;all&#39;, &#39;extra&#39;, &#39;custom&#39;}</span>
</span><span id="MicronsDataCleaner-91"><a href="#MicronsDataCleaner-91"><span class="linenos"> 91</span></a><span class="sd">                The policy that determines which tables will be included in the download list.</span>
</span><span id="MicronsDataCleaner-92"><a href="#MicronsDataCleaner-92"><span class="linenos"> 92</span></a><span class="sd">            extra_tables : list[str]</span>
</span><span id="MicronsDataCleaner-93"><a href="#MicronsDataCleaner-93"><span class="linenos"> 93</span></a><span class="sd">                A list of extra table names to be considered when the `download_policy`</span>
</span><span id="MicronsDataCleaner-94"><a href="#MicronsDataCleaner-94"><span class="linenos"> 94</span></a><span class="sd">                is &#39;extra&#39; or &#39;custom&#39;.</span>
</span><span id="MicronsDataCleaner-95"><a href="#MicronsDataCleaner-95"><span class="linenos"> 95</span></a><span class="sd">    </span>
</span><span id="MicronsDataCleaner-96"><a href="#MicronsDataCleaner-96"><span class="linenos"> 96</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner-97"><a href="#MicronsDataCleaner-97"><span class="linenos"> 97</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner-98"><a href="#MicronsDataCleaner-98"><span class="linenos"> 98</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner-99"><a href="#MicronsDataCleaner-99"><span class="linenos"> 99</span></a><span class="sd">                This method does not return a value. It modifies the instance attributes</span>
</span><span id="MicronsDataCleaner-100"><a href="#MicronsDataCleaner-100"><span class="linenos">100</span></a><span class="sd">                `self.tables` and `self.tables_2_download` in-place.</span>
</span><span id="MicronsDataCleaner-101"><a href="#MicronsDataCleaner-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-102"><a href="#MicronsDataCleaner-102"><span class="linenos">102</span></a>        
</span><span id="MicronsDataCleaner-103"><a href="#MicronsDataCleaner-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MicronsDataCleaner-104"><a href="#MicronsDataCleaner-104"><span class="linenos">104</span></a>
</span><span id="MicronsDataCleaner-105"><a href="#MicronsDataCleaner-105"><span class="linenos">105</span></a>        <span class="k">match</span> <span class="n">version</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-106"><a href="#MicronsDataCleaner-106"><span class="linenos">106</span></a>            <span class="k">case</span> <span class="mi">1300</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-107"><a href="#MicronsDataCleaner-107"><span class="linenos">107</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;nucleus&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="s2">&quot;nucleus_detection_v0&quot;</span>
</span><span id="MicronsDataCleaner-108"><a href="#MicronsDataCleaner-108"><span class="linenos">108</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;celltype&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="s2">&quot;aibs_metamodel_celltypes_v661&quot;</span>
</span><span id="MicronsDataCleaner-109"><a href="#MicronsDataCleaner-109"><span class="linenos">109</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;proofreading&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;proofreading_status_and_strategy&quot;</span>
</span><span id="MicronsDataCleaner-110"><a href="#MicronsDataCleaner-110"><span class="linenos">110</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;brain_areas&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s2">&quot;nucleus_functional_area_assignment&quot;</span>
</span><span id="MicronsDataCleaner-111"><a href="#MicronsDataCleaner-111"><span class="linenos">111</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;func_props&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s2">&quot;functional_properties_v3_bcm&quot;</span>
</span><span id="MicronsDataCleaner-112"><a href="#MicronsDataCleaner-112"><span class="linenos">112</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;coreg&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="s2">&quot;coregistration_manual_v4&quot;</span>
</span><span id="MicronsDataCleaner-113"><a href="#MicronsDataCleaner-113"><span class="linenos">113</span></a>
</span><span id="MicronsDataCleaner-114"><a href="#MicronsDataCleaner-114"><span class="linenos">114</span></a>        <span class="c1"># Set the tables that we will need to download.</span>
</span><span id="MicronsDataCleaner-115"><a href="#MicronsDataCleaner-115"><span class="linenos">115</span></a>        <span class="k">match</span> <span class="n">download_policy</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-116"><a href="#MicronsDataCleaner-116"><span class="linenos">116</span></a>            <span class="c1"># Default. Gets only the ones we will use to generate our unit table </span>
</span><span id="MicronsDataCleaner-117"><a href="#MicronsDataCleaner-117"><span class="linenos">117</span></a>            <span class="k">case</span> <span class="s1">&#39;minimum&#39;</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-118"><a href="#MicronsDataCleaner-118"><span class="linenos">118</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tables_2_download</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> 
</span><span id="MicronsDataCleaner-119"><a href="#MicronsDataCleaner-119"><span class="linenos">119</span></a>
</span><span id="MicronsDataCleaner-120"><a href="#MicronsDataCleaner-120"><span class="linenos">120</span></a>            <span class="c1"># All gets all available tables for this version</span>
</span><span id="MicronsDataCleaner-121"><a href="#MicronsDataCleaner-121"><span class="linenos">121</span></a>            <span class="k">case</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-122"><a href="#MicronsDataCleaner-122"><span class="linenos">122</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tables_2_download</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table_list</span><span class="p">()</span>
</span><span id="MicronsDataCleaner-123"><a href="#MicronsDataCleaner-123"><span class="linenos">123</span></a>
</span><span id="MicronsDataCleaner-124"><a href="#MicronsDataCleaner-124"><span class="linenos">124</span></a>            <span class="c1"># Get the minimum ones + the tables specified in the extra array</span>
</span><span id="MicronsDataCleaner-125"><a href="#MicronsDataCleaner-125"><span class="linenos">125</span></a>            <span class="k">case</span> <span class="s1">&#39;extra&#39;</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-126"><a href="#MicronsDataCleaner-126"><span class="linenos">126</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tables_2_download</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="n">extra_tables</span> 
</span><span id="MicronsDataCleaner-127"><a href="#MicronsDataCleaner-127"><span class="linenos">127</span></a>            
</span><span id="MicronsDataCleaner-128"><a href="#MicronsDataCleaner-128"><span class="linenos">128</span></a>            <span class="c1"># Any other string is an error</span>
</span><span id="MicronsDataCleaner-129"><a href="#MicronsDataCleaner-129"><span class="linenos">129</span></a>            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span> 
</span><span id="MicronsDataCleaner-130"><a href="#MicronsDataCleaner-130"><span class="linenos">130</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid download policy: </span><span class="si">{</span><span class="n">download_policy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-131"><a href="#MicronsDataCleaner-131"><span class="linenos">131</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`download_tables` must be either `default`, `all` or `extra`&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-132"><a href="#MicronsDataCleaner-132"><span class="linenos">132</span></a>
</span><span id="MicronsDataCleaner-133"><a href="#MicronsDataCleaner-133"><span class="linenos">133</span></a>        <span class="c1"># Eliminate any &#39;None&#39; value that could have appeared</span>
</span><span id="MicronsDataCleaner-134"><a href="#MicronsDataCleaner-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tables_2_download</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables_2_download</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span> 
</span><span id="MicronsDataCleaner-135"><a href="#MicronsDataCleaner-135"><span class="linenos">135</span></a>
</span><span id="MicronsDataCleaner-136"><a href="#MicronsDataCleaner-136"><span class="linenos">136</span></a>    
</span><span id="MicronsDataCleaner-137"><a href="#MicronsDataCleaner-137"><span class="linenos">137</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_functional_fits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foldername</span><span class="o">=</span><span class="s2">&quot;functional&quot;</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-138"><a href="#MicronsDataCleaner-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-139"><a href="#MicronsDataCleaner-139"><span class="linenos">139</span></a><span class="sd">        Downloads functional tuning curves and fits from Zenodo.</span>
</span><span id="MicronsDataCleaner-140"><a href="#MicronsDataCleaner-140"><span class="linenos">140</span></a><span class="sd">        This convenience method downloads a pre-processed data file containing</span>
</span><span id="MicronsDataCleaner-141"><a href="#MicronsDataCleaner-141"><span class="linenos">141</span></a><span class="sd">        functional tuning curves and their fits. The data is hosted on Zenodo</span>
</span><span id="MicronsDataCleaner-142"><a href="#MicronsDataCleaner-142"><span class="linenos">142</span></a><span class="sd">        and has been specifically prepared for use with this package. The method</span>
</span><span id="MicronsDataCleaner-143"><a href="#MicronsDataCleaner-143"><span class="linenos">143</span></a><span class="sd">        handles the creation of the destination folder before initiating the download.</span>
</span><span id="MicronsDataCleaner-144"><a href="#MicronsDataCleaner-144"><span class="linenos">144</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-145"><a href="#MicronsDataCleaner-145"><span class="linenos">145</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner-146"><a href="#MicronsDataCleaner-146"><span class="linenos">146</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner-147"><a href="#MicronsDataCleaner-147"><span class="linenos">147</span></a><span class="sd">        - **foldername : *str, optional***</span>
</span><span id="MicronsDataCleaner-148"><a href="#MicronsDataCleaner-148"><span class="linenos">148</span></a>
</span><span id="MicronsDataCleaner-149"><a href="#MicronsDataCleaner-149"><span class="linenos">149</span></a><span class="sd">            The name of the subfolder within the main data directory where the</span>
</span><span id="MicronsDataCleaner-150"><a href="#MicronsDataCleaner-150"><span class="linenos">150</span></a><span class="sd">            data will be saved, by default &quot;functional&quot;. If this folder does</span>
</span><span id="MicronsDataCleaner-151"><a href="#MicronsDataCleaner-151"><span class="linenos">151</span></a><span class="sd">            not exist, it will be created.</span>
</span><span id="MicronsDataCleaner-152"><a href="#MicronsDataCleaner-152"><span class="linenos">152</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-153"><a href="#MicronsDataCleaner-153"><span class="linenos">153</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner-154"><a href="#MicronsDataCleaner-154"><span class="linenos">154</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner-155"><a href="#MicronsDataCleaner-155"><span class="linenos">155</span></a><span class="sd">        - **None.**</span>
</span><span id="MicronsDataCleaner-156"><a href="#MicronsDataCleaner-156"><span class="linenos">156</span></a>
</span><span id="MicronsDataCleaner-157"><a href="#MicronsDataCleaner-157"><span class="linenos">157</span></a><span class="sd">            This method does not return a value. It saves the downloaded data to</span>
</span><span id="MicronsDataCleaner-158"><a href="#MicronsDataCleaner-158"><span class="linenos">158</span></a><span class="sd">            a file named &#39;tuning_curves_fitted_v1.csv&#39; inside the specified folder.</span>
</span><span id="MicronsDataCleaner-159"><a href="#MicronsDataCleaner-159"><span class="linenos">159</span></a>
</span><span id="MicronsDataCleaner-160"><a href="#MicronsDataCleaner-160"><span class="linenos">160</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-161"><a href="#MicronsDataCleaner-161"><span class="linenos">161</span></a>
</span><span id="MicronsDataCleaner-162"><a href="#MicronsDataCleaner-162"><span class="linenos">162</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">homedir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">foldername</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-163"><a href="#MicronsDataCleaner-163"><span class="linenos">163</span></a>        <span class="n">down</span><span class="o">.</span><span class="n">download_functional_fits</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">homedir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">foldername</span><span class="si">}</span><span class="s2">/tuning_curves_fitted_v1.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-164"><a href="#MicronsDataCleaner-164"><span class="linenos">164</span></a>
</span><span id="MicronsDataCleaner-165"><a href="#MicronsDataCleaner-165"><span class="linenos">165</span></a>
</span><span id="MicronsDataCleaner-166"><a href="#MicronsDataCleaner-166"><span class="linenos">166</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-167"><a href="#MicronsDataCleaner-167"><span class="linenos">167</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-168"><a href="#MicronsDataCleaner-168"><span class="linenos">168</span></a><span class="sd">        Initializes and configures the CAVEClient for a specific dataset version.</span>
</span><span id="MicronsDataCleaner-169"><a href="#MicronsDataCleaner-169"><span class="linenos">169</span></a><span class="sd">        This internal helper method creates an instance of the CAVEclient,</span>
</span><span id="MicronsDataCleaner-170"><a href="#MicronsDataCleaner-170"><span class="linenos">170</span></a><span class="sd">        pointing to the &#39;minnie65_public&#39; datastack, and sets the desired</span>
</span><span id="MicronsDataCleaner-171"><a href="#MicronsDataCleaner-171"><span class="linenos">171</span></a><span class="sd">        materialization version. It is called by the constructor and is not</span>
</span><span id="MicronsDataCleaner-172"><a href="#MicronsDataCleaner-172"><span class="linenos">172</span></a><span class="sd">        intended for direct use by the end-user.</span>
</span><span id="MicronsDataCleaner-173"><a href="#MicronsDataCleaner-173"><span class="linenos">173</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-174"><a href="#MicronsDataCleaner-174"><span class="linenos">174</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner-175"><a href="#MicronsDataCleaner-175"><span class="linenos">175</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner-176"><a href="#MicronsDataCleaner-176"><span class="linenos">176</span></a><span class="sd">            version: int</span>
</span><span id="MicronsDataCleaner-177"><a href="#MicronsDataCleaner-177"><span class="linenos">177</span></a><span class="sd">                The materialization version to be used for all subsequent data queries.</span>
</span><span id="MicronsDataCleaner-178"><a href="#MicronsDataCleaner-178"><span class="linenos">178</span></a><span class="sd">                If left at None, it points to the last one.</span>
</span><span id="MicronsDataCleaner-179"><a href="#MicronsDataCleaner-179"><span class="linenos">179</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-180"><a href="#MicronsDataCleaner-180"><span class="linenos">180</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner-181"><a href="#MicronsDataCleaner-181"><span class="linenos">181</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner-182"><a href="#MicronsDataCleaner-182"><span class="linenos">182</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner-183"><a href="#MicronsDataCleaner-183"><span class="linenos">183</span></a><span class="sd">                This method does not return a value. It sets the `self.client`</span>
</span><span id="MicronsDataCleaner-184"><a href="#MicronsDataCleaner-184"><span class="linenos">184</span></a><span class="sd">                attribute on the class instance.</span>
</span><span id="MicronsDataCleaner-185"><a href="#MicronsDataCleaner-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-186"><a href="#MicronsDataCleaner-186"><span class="linenos">186</span></a>        
</span><span id="MicronsDataCleaner-187"><a href="#MicronsDataCleaner-187"><span class="linenos">187</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing CAVEclient for minnie65_public, version </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-188"><a href="#MicronsDataCleaner-188"><span class="linenos">188</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-189"><a href="#MicronsDataCleaner-189"><span class="linenos">189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">CAVEclient</span><span class="p">(</span><span class="s1">&#39;minnie65_public&#39;</span><span class="p">)</span> 
</span><span id="MicronsDataCleaner-190"><a href="#MicronsDataCleaner-190"><span class="linenos">190</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
</span><span id="MicronsDataCleaner-191"><a href="#MicronsDataCleaner-191"><span class="linenos">191</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;CAVEclient initialized successfully.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-192"><a href="#MicronsDataCleaner-192"><span class="linenos">192</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">excep</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-193"><a href="#MicronsDataCleaner-193"><span class="linenos">193</span></a>            <span class="k">if</span> <span class="s1">&#39;503&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">excep</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-194"><a href="#MicronsDataCleaner-194"><span class="linenos">194</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;HTTP error 503: the MICrONS server is temporarily unavailable. Client cannot be used for new downloads.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-195"><a href="#MicronsDataCleaner-195"><span class="linenos">195</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HTTP error 503: the MICrONS server is temporarily unavailable. Client cannot be used for new downloads.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-196"><a href="#MicronsDataCleaner-196"><span class="linenos">196</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-197"><a href="#MicronsDataCleaner-197"><span class="linenos">197</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unhandled exception during while setting up the client: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excep</span><span class="p">))</span>
</span><span id="MicronsDataCleaner-198"><a href="#MicronsDataCleaner-198"><span class="linenos">198</span></a>                <span class="k">raise</span> <span class="n">excep</span>
</span><span id="MicronsDataCleaner-199"><a href="#MicronsDataCleaner-199"><span class="linenos">199</span></a>        <span class="k">return</span>
</span><span id="MicronsDataCleaner-200"><a href="#MicronsDataCleaner-200"><span class="linenos">200</span></a>
</span><span id="MicronsDataCleaner-201"><a href="#MicronsDataCleaner-201"><span class="linenos">201</span></a>    
</span><span id="MicronsDataCleaner-202"><a href="#MicronsDataCleaner-202"><span class="linenos">202</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_table_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-203"><a href="#MicronsDataCleaner-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-204"><a href="#MicronsDataCleaner-204"><span class="linenos">204</span></a><span class="sd">        Retrieves a list of all available tables for the current version.</span>
</span><span id="MicronsDataCleaner-205"><a href="#MicronsDataCleaner-205"><span class="linenos">205</span></a><span class="sd">        This method queries the CAVEclient to get the names of all tables</span>
</span><span id="MicronsDataCleaner-206"><a href="#MicronsDataCleaner-206"><span class="linenos">206</span></a><span class="sd">        available in the currently configured materialization version.</span>
</span><span id="MicronsDataCleaner-207"><a href="#MicronsDataCleaner-207"><span class="linenos">207</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-208"><a href="#MicronsDataCleaner-208"><span class="linenos">208</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner-209"><a href="#MicronsDataCleaner-209"><span class="linenos">209</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner-210"><a href="#MicronsDataCleaner-210"><span class="linenos">210</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner-211"><a href="#MicronsDataCleaner-211"><span class="linenos">211</span></a><span class="sd">            </span>
</span><span id="MicronsDataCleaner-212"><a href="#MicronsDataCleaner-212"><span class="linenos">212</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner-213"><a href="#MicronsDataCleaner-213"><span class="linenos">213</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner-214"><a href="#MicronsDataCleaner-214"><span class="linenos">214</span></a><span class="sd">            list[str]</span>
</span><span id="MicronsDataCleaner-215"><a href="#MicronsDataCleaner-215"><span class="linenos">215</span></a><span class="sd">                A list of strings, where each string is the name of an available</span>
</span><span id="MicronsDataCleaner-216"><a href="#MicronsDataCleaner-216"><span class="linenos">216</span></a><span class="sd">                table in the dataset.</span>
</span><span id="MicronsDataCleaner-217"><a href="#MicronsDataCleaner-217"><span class="linenos">217</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-218"><a href="#MicronsDataCleaner-218"><span class="linenos">218</span></a>
</span><span id="MicronsDataCleaner-219"><a href="#MicronsDataCleaner-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">materialize</span><span class="o">.</span><span class="n">get_tables</span><span class="p">()</span>
</span><span id="MicronsDataCleaner-220"><a href="#MicronsDataCleaner-220"><span class="linenos">220</span></a>
</span><span id="MicronsDataCleaner-221"><a href="#MicronsDataCleaner-221"><span class="linenos">221</span></a>    
</span><span id="MicronsDataCleaner-222"><a href="#MicronsDataCleaner-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-223"><a href="#MicronsDataCleaner-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-224"><a href="#MicronsDataCleaner-224"><span class="linenos">224</span></a><span class="sd">        Reads a specified table from a local CSV file into a pandas DataFrame.</span>
</span><span id="MicronsDataCleaner-225"><a href="#MicronsDataCleaner-225"><span class="linenos">225</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-226"><a href="#MicronsDataCleaner-226"><span class="linenos">226</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner-227"><a href="#MicronsDataCleaner-227"><span class="linenos">227</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner-228"><a href="#MicronsDataCleaner-228"><span class="linenos">228</span></a><span class="sd">            table_name: str</span>
</span><span id="MicronsDataCleaner-229"><a href="#MicronsDataCleaner-229"><span class="linenos">229</span></a><span class="sd">                The name of the table to read.</span>
</span><span id="MicronsDataCleaner-230"><a href="#MicronsDataCleaner-230"><span class="linenos">230</span></a>
</span><span id="MicronsDataCleaner-231"><a href="#MicronsDataCleaner-231"><span class="linenos">231</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner-232"><a href="#MicronsDataCleaner-232"><span class="linenos">232</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner-233"><a href="#MicronsDataCleaner-233"><span class="linenos">233</span></a><span class="sd">            pandas.DataFrame</span>
</span><span id="MicronsDataCleaner-234"><a href="#MicronsDataCleaner-234"><span class="linenos">234</span></a><span class="sd">                A DataFrame containing the data from the specified CSV file.</span>
</span><span id="MicronsDataCleaner-235"><a href="#MicronsDataCleaner-235"><span class="linenos">235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-236"><a href="#MicronsDataCleaner-236"><span class="linenos">236</span></a>
</span><span id="MicronsDataCleaner-237"><a href="#MicronsDataCleaner-237"><span class="linenos">237</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">table_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-238"><a href="#MicronsDataCleaner-238"><span class="linenos">238</span></a>            <span class="n">table_name</span> <span class="o">+=</span> <span class="s2">&quot;.csv&quot;</span>
</span><span id="MicronsDataCleaner-239"><a href="#MicronsDataCleaner-239"><span class="linenos">239</span></a>        
</span><span id="MicronsDataCleaner-240"><a href="#MicronsDataCleaner-240"><span class="linenos">240</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
</span><span id="MicronsDataCleaner-241"><a href="#MicronsDataCleaner-241"><span class="linenos">241</span></a>
</span><span id="MicronsDataCleaner-242"><a href="#MicronsDataCleaner-242"><span class="linenos">242</span></a>    
</span><span id="MicronsDataCleaner-243"><a href="#MicronsDataCleaner-243"><span class="linenos">243</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_nucleus_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-244"><a href="#MicronsDataCleaner-244"><span class="linenos">244</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-245"><a href="#MicronsDataCleaner-245"><span class="linenos">245</span></a><span class="sd">        Downloads all nucleus-related tables based on the initial configuration.</span>
</span><span id="MicronsDataCleaner-246"><a href="#MicronsDataCleaner-246"><span class="linenos">246</span></a><span class="sd">        The specific tables downloaded depend on the `download_policy` chosen at initialization.</span>
</span><span id="MicronsDataCleaner-247"><a href="#MicronsDataCleaner-247"><span class="linenos">247</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-248"><a href="#MicronsDataCleaner-248"><span class="linenos">248</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner-249"><a href="#MicronsDataCleaner-249"><span class="linenos">249</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner-250"><a href="#MicronsDataCleaner-250"><span class="linenos">250</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner-251"><a href="#MicronsDataCleaner-251"><span class="linenos">251</span></a><span class="sd">            </span>
</span><span id="MicronsDataCleaner-252"><a href="#MicronsDataCleaner-252"><span class="linenos">252</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner-253"><a href="#MicronsDataCleaner-253"><span class="linenos">253</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner-254"><a href="#MicronsDataCleaner-254"><span class="linenos">254</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner-255"><a href="#MicronsDataCleaner-255"><span class="linenos">255</span></a><span class="sd">                This method does not return a value. It saves the downloaded tables</span>
</span><span id="MicronsDataCleaner-256"><a href="#MicronsDataCleaner-256"><span class="linenos">256</span></a><span class="sd">                as CSV files in the `raw` data directory. </span>
</span><span id="MicronsDataCleaner-257"><a href="#MicronsDataCleaner-257"><span class="linenos">257</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-258"><a href="#MicronsDataCleaner-258"><span class="linenos">258</span></a>
</span><span id="MicronsDataCleaner-259"><a href="#MicronsDataCleaner-259"><span class="linenos">259</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading nucleus data tables: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables_2_download</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-260"><a href="#MicronsDataCleaner-260"><span class="linenos">260</span></a>        <span class="n">down</span><span class="o">.</span><span class="n">download_tables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">tables_2_download</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-261"><a href="#MicronsDataCleaner-261"><span class="linenos">261</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Nucleus data download completed.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-262"><a href="#MicronsDataCleaner-262"><span class="linenos">262</span></a>        <span class="k">return</span>
</span><span id="MicronsDataCleaner-263"><a href="#MicronsDataCleaner-263"><span class="linenos">263</span></a>
</span><span id="MicronsDataCleaner-264"><a href="#MicronsDataCleaner-264"><span class="linenos">264</span></a>    
</span><span id="MicronsDataCleaner-265"><a href="#MicronsDataCleaner-265"><span class="linenos">265</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_names</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-266"><a href="#MicronsDataCleaner-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-267"><a href="#MicronsDataCleaner-267"><span class="linenos">267</span></a><span class="sd">        Downloads a user-specified list of tables.</span>
</span><span id="MicronsDataCleaner-268"><a href="#MicronsDataCleaner-268"><span class="linenos">268</span></a><span class="sd">        This method allows for downloading an arbitrary list of tables from the</span>
</span><span id="MicronsDataCleaner-269"><a href="#MicronsDataCleaner-269"><span class="linenos">269</span></a><span class="sd">        database, in addition to those specified by the download policy during</span>
</span><span id="MicronsDataCleaner-270"><a href="#MicronsDataCleaner-270"><span class="linenos">270</span></a><span class="sd">        initialization.</span>
</span><span id="MicronsDataCleaner-271"><a href="#MicronsDataCleaner-271"><span class="linenos">271</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-272"><a href="#MicronsDataCleaner-272"><span class="linenos">272</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner-273"><a href="#MicronsDataCleaner-273"><span class="linenos">273</span></a><span class="sd">        ----------- </span>
</span><span id="MicronsDataCleaner-274"><a href="#MicronsDataCleaner-274"><span class="linenos">274</span></a><span class="sd">            table_names: list[str]</span>
</span><span id="MicronsDataCleaner-275"><a href="#MicronsDataCleaner-275"><span class="linenos">275</span></a><span class="sd">                A list containing the exact names of the tables to be downloaded.</span>
</span><span id="MicronsDataCleaner-276"><a href="#MicronsDataCleaner-276"><span class="linenos">276</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-277"><a href="#MicronsDataCleaner-277"><span class="linenos">277</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner-278"><a href="#MicronsDataCleaner-278"><span class="linenos">278</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner-279"><a href="#MicronsDataCleaner-279"><span class="linenos">279</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner-280"><a href="#MicronsDataCleaner-280"><span class="linenos">280</span></a><span class="sd">                This method does not return a value. It saves the downloaded tables</span>
</span><span id="MicronsDataCleaner-281"><a href="#MicronsDataCleaner-281"><span class="linenos">281</span></a><span class="sd">                as CSV files in the `raw` data directory.</span>
</span><span id="MicronsDataCleaner-282"><a href="#MicronsDataCleaner-282"><span class="linenos">282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-283"><a href="#MicronsDataCleaner-283"><span class="linenos">283</span></a>
</span><span id="MicronsDataCleaner-284"><a href="#MicronsDataCleaner-284"><span class="linenos">284</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading custom tables: </span><span class="si">{</span><span class="n">table_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-285"><a href="#MicronsDataCleaner-285"><span class="linenos">285</span></a>        <span class="n">down</span><span class="o">.</span><span class="n">download_tables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/&quot;</span><span class="p">,</span>  <span class="n">table_names</span><span class="p">)</span> 
</span><span id="MicronsDataCleaner-286"><a href="#MicronsDataCleaner-286"><span class="linenos">286</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Custom tables download completed.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-287"><a href="#MicronsDataCleaner-287"><span class="linenos">287</span></a>        <span class="k">return</span>
</span><span id="MicronsDataCleaner-288"><a href="#MicronsDataCleaner-288"><span class="linenos">288</span></a>
</span><span id="MicronsDataCleaner-289"><a href="#MicronsDataCleaner-289"><span class="linenos">289</span></a>
</span><span id="MicronsDataCleaner-290"><a href="#MicronsDataCleaner-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_synapse_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">presynaptic_set</span><span class="p">,</span> <span class="n">postsynaptic_set</span><span class="p">,</span> <span class="n">neurs_per_steps</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">start_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">drop_synapses_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-291"><a href="#MicronsDataCleaner-291"><span class="linenos">291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-292"><a href="#MicronsDataCleaner-292"><span class="linenos">292</span></a><span class="sd">        Downloads synaptic connections between specified sets of neurons.</span>
</span><span id="MicronsDataCleaner-293"><a href="#MicronsDataCleaner-293"><span class="linenos">293</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-294"><a href="#MicronsDataCleaner-294"><span class="linenos">294</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner-295"><a href="#MicronsDataCleaner-295"><span class="linenos">295</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner-296"><a href="#MicronsDataCleaner-296"><span class="linenos">296</span></a><span class="sd">            presynaptic_set: numpy.ndarray</span>
</span><span id="MicronsDataCleaner-297"><a href="#MicronsDataCleaner-297"><span class="linenos">297</span></a><span class="sd">                A 1D NumPy array of unique `root_ids` for the presynaptic neurons.</span>
</span><span id="MicronsDataCleaner-298"><a href="#MicronsDataCleaner-298"><span class="linenos">298</span></a><span class="sd">            postsynaptic_set: numpy.ndarray</span>
</span><span id="MicronsDataCleaner-299"><a href="#MicronsDataCleaner-299"><span class="linenos">299</span></a><span class="sd">                A 1D NumPy array of unique `root_ids` for the postsynaptic neurons.</span>
</span><span id="MicronsDataCleaner-300"><a href="#MicronsDataCleaner-300"><span class="linenos">300</span></a><span class="sd">            neurs_per_steps: int, optional</span>
</span><span id="MicronsDataCleaner-301"><a href="#MicronsDataCleaner-301"><span class="linenos">301</span></a><span class="sd">                The number of postsynaptic neurons to query per batch, by default 500.</span>
</span><span id="MicronsDataCleaner-302"><a href="#MicronsDataCleaner-302"><span class="linenos">302</span></a><span class="sd">                This is crucial for managing API query size and preventing crashes.</span>
</span><span id="MicronsDataCleaner-303"><a href="#MicronsDataCleaner-303"><span class="linenos">303</span></a><span class="sd">            start_index: int, optional</span>
</span><span id="MicronsDataCleaner-304"><a href="#MicronsDataCleaner-304"><span class="linenos">304</span></a><span class="sd">                The batch index from which to start or resume the download, by default 0.</span>
</span><span id="MicronsDataCleaner-305"><a href="#MicronsDataCleaner-305"><span class="linenos">305</span></a><span class="sd">                Set this to continue an interrupted download.</span>
</span><span id="MicronsDataCleaner-306"><a href="#MicronsDataCleaner-306"><span class="linenos">306</span></a><span class="sd">            max_retries: int, optional</span>
</span><span id="MicronsDataCleaner-307"><a href="#MicronsDataCleaner-307"><span class="linenos">307</span></a><span class="sd">                The maximum number of times to retry a failed API query before</span>
</span><span id="MicronsDataCleaner-308"><a href="#MicronsDataCleaner-308"><span class="linenos">308</span></a><span class="sd">                raising an error, by default 10.</span>
</span><span id="MicronsDataCleaner-309"><a href="#MicronsDataCleaner-309"><span class="linenos">309</span></a><span class="sd">            delay: int, optional</span>
</span><span id="MicronsDataCleaner-310"><a href="#MicronsDataCleaner-310"><span class="linenos">310</span></a><span class="sd">                The number of seconds to wait between retries if an API error occurs,</span>
</span><span id="MicronsDataCleaner-311"><a href="#MicronsDataCleaner-311"><span class="linenos">311</span></a><span class="sd">                by default 5.</span>
</span><span id="MicronsDataCleaner-312"><a href="#MicronsDataCleaner-312"><span class="linenos">312</span></a><span class="sd">            drop_synapses_duplicates: bool, optional</span>
</span><span id="MicronsDataCleaner-313"><a href="#MicronsDataCleaner-313"><span class="linenos">313</span></a><span class="sd">                If True (default), all synapses between any two neurons are merged into a</span>
</span><span id="MicronsDataCleaner-314"><a href="#MicronsDataCleaner-314"><span class="linenos">314</span></a><span class="sd">                single entry, with `synapse_size` being the sum of individual sizes.</span>
</span><span id="MicronsDataCleaner-315"><a href="#MicronsDataCleaner-315"><span class="linenos">315</span></a><span class="sd">                If False, each synapse is kept as a separate record.</span>
</span><span id="MicronsDataCleaner-316"><a href="#MicronsDataCleaner-316"><span class="linenos">316</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-317"><a href="#MicronsDataCleaner-317"><span class="linenos">317</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner-318"><a href="#MicronsDataCleaner-318"><span class="linenos">318</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner-319"><a href="#MicronsDataCleaner-319"><span class="linenos">319</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner-320"><a href="#MicronsDataCleaner-320"><span class="linenos">320</span></a><span class="sd">                This method does not return a value. It saves the downloaded synapse</span>
</span><span id="MicronsDataCleaner-321"><a href="#MicronsDataCleaner-321"><span class="linenos">321</span></a><span class="sd">                tables as a series of CSV files in the `raw/synapses` directory.</span>
</span><span id="MicronsDataCleaner-322"><a href="#MicronsDataCleaner-322"><span class="linenos">322</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-323"><a href="#MicronsDataCleaner-323"><span class="linenos">323</span></a>       
</span><span id="MicronsDataCleaner-324"><a href="#MicronsDataCleaner-324"><span class="linenos">324</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Starting synapse data download.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-325"><a href="#MicronsDataCleaner-325"><span class="linenos">325</span></a>        <span class="n">down</span><span class="o">.</span><span class="n">connectome_constructor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">,</span> <span class="n">presynaptic_set</span><span class="p">,</span> <span class="n">postsynaptic_set</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/synapses&quot;</span><span class="p">,</span>
</span><span id="MicronsDataCleaner-326"><a href="#MicronsDataCleaner-326"><span class="linenos">326</span></a>                                   <span class="n">neurs_per_steps</span> <span class="o">=</span> <span class="n">neurs_per_steps</span><span class="p">,</span> <span class="n">start_index</span><span class="o">=</span><span class="n">start_index</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span> <span class="n">drop_synapses_duplicates</span><span class="o">=</span><span class="n">drop_synapses_duplicates</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-327"><a href="#MicronsDataCleaner-327"><span class="linenos">327</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Synapse data download completed.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-328"><a href="#MicronsDataCleaner-328"><span class="linenos">328</span></a>        <span class="k">return</span>
</span><span id="MicronsDataCleaner-329"><a href="#MicronsDataCleaner-329"><span class="linenos">329</span></a>
</span><span id="MicronsDataCleaner-330"><a href="#MicronsDataCleaner-330"><span class="linenos">330</span></a>    
</span><span id="MicronsDataCleaner-331"><a href="#MicronsDataCleaner-331"><span class="linenos">331</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">merge_synapses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syn_table_name</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-332"><a href="#MicronsDataCleaner-332"><span class="linenos">332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-333"><a href="#MicronsDataCleaner-333"><span class="linenos">333</span></a><span class="sd">        Merges downloaded synapse data batches into a single CSV file.</span>
</span><span id="MicronsDataCleaner-334"><a href="#MicronsDataCleaner-334"><span class="linenos">334</span></a>
</span><span id="MicronsDataCleaner-335"><a href="#MicronsDataCleaner-335"><span class="linenos">335</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner-336"><a href="#MicronsDataCleaner-336"><span class="linenos">336</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner-337"><a href="#MicronsDataCleaner-337"><span class="linenos">337</span></a><span class="sd">            syn_table_name: str</span>
</span><span id="MicronsDataCleaner-338"><a href="#MicronsDataCleaner-338"><span class="linenos">338</span></a><span class="sd">                The name for the output file that will contain the merged synapse data.</span>
</span><span id="MicronsDataCleaner-339"><a href="#MicronsDataCleaner-339"><span class="linenos">339</span></a><span class="sd">                </span>
</span><span id="MicronsDataCleaner-340"><a href="#MicronsDataCleaner-340"><span class="linenos">340</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner-341"><a href="#MicronsDataCleaner-341"><span class="linenos">341</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner-342"><a href="#MicronsDataCleaner-342"><span class="linenos">342</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner-343"><a href="#MicronsDataCleaner-343"><span class="linenos">343</span></a><span class="sd">                This method does not return a value. It saves the merged table to a file.</span>
</span><span id="MicronsDataCleaner-344"><a href="#MicronsDataCleaner-344"><span class="linenos">344</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-345"><a href="#MicronsDataCleaner-345"><span class="linenos">345</span></a>        
</span><span id="MicronsDataCleaner-346"><a href="#MicronsDataCleaner-346"><span class="linenos">346</span></a>        <span class="n">down</span><span class="o">.</span><span class="n">merge_connection_tables</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw&quot;</span><span class="p">,</span> <span class="n">syn_table_name</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-347"><a href="#MicronsDataCleaner-347"><span class="linenos">347</span></a>        <span class="k">return</span>
</span><span id="MicronsDataCleaner-348"><a href="#MicronsDataCleaner-348"><span class="linenos">348</span></a>
</span><span id="MicronsDataCleaner-349"><a href="#MicronsDataCleaner-349"><span class="linenos">349</span></a>    
</span><span id="MicronsDataCleaner-350"><a href="#MicronsDataCleaner-350"><span class="linenos">350</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">merge_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit_table</span><span class="p">,</span> <span class="n">new_table</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nucleus_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-351"><a href="#MicronsDataCleaner-351"><span class="linenos">351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-352"><a href="#MicronsDataCleaner-352"><span class="linenos">352</span></a><span class="sd">        Merges new columns from a source table into the main unit table.</span>
</span><span id="MicronsDataCleaner-353"><a href="#MicronsDataCleaner-353"><span class="linenos">353</span></a>
</span><span id="MicronsDataCleaner-354"><a href="#MicronsDataCleaner-354"><span class="linenos">354</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner-355"><a href="#MicronsDataCleaner-355"><span class="linenos">355</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner-356"><a href="#MicronsDataCleaner-356"><span class="linenos">356</span></a><span class="sd">            unit_table: pandas.DataFrame</span>
</span><span id="MicronsDataCleaner-357"><a href="#MicronsDataCleaner-357"><span class="linenos">357</span></a><span class="sd">                The primary DataFrame to which new columns will be added.</span>
</span><span id="MicronsDataCleaner-358"><a href="#MicronsDataCleaner-358"><span class="linenos">358</span></a><span class="sd">            new_table: pandas.DataFrame</span>
</span><span id="MicronsDataCleaner-359"><a href="#MicronsDataCleaner-359"><span class="linenos">359</span></a><span class="sd">                The source DataFrame from which to pull the new columns.</span>
</span><span id="MicronsDataCleaner-360"><a href="#MicronsDataCleaner-360"><span class="linenos">360</span></a><span class="sd">            columns: list[str] or None</span>
</span><span id="MicronsDataCleaner-361"><a href="#MicronsDataCleaner-361"><span class="linenos">361</span></a><span class="sd">                A list of column names from `new_table` to merge into `unit_table`.</span>
</span><span id="MicronsDataCleaner-362"><a href="#MicronsDataCleaner-362"><span class="linenos">362</span></a><span class="sd">                If None, all columns from `new_table` (except the join keys) are used.</span>
</span><span id="MicronsDataCleaner-363"><a href="#MicronsDataCleaner-363"><span class="linenos">363</span></a><span class="sd">            method: str </span>
</span><span id="MicronsDataCleaner-364"><a href="#MicronsDataCleaner-364"><span class="linenos">364</span></a><span class="sd">                How the tables will be compared to each other. If &#39;nucleus_id&#39; (default), the target_id </span>
</span><span id="MicronsDataCleaner-365"><a href="#MicronsDataCleaner-365"><span class="linenos">365</span></a><span class="sd">                is matched to the nucleus_id. If functional, the session, scan and unit_id are compared. </span>
</span><span id="MicronsDataCleaner-366"><a href="#MicronsDataCleaner-366"><span class="linenos">366</span></a><span class="sd">                If &#39;pt_root_id&#39;, merge by &#39;pt_root_id&#39;. This last option is not adviced, unless is the only index available.</span>
</span><span id="MicronsDataCleaner-367"><a href="#MicronsDataCleaner-367"><span class="linenos">367</span></a><span class="sd">            how: str</span>
</span><span id="MicronsDataCleaner-368"><a href="#MicronsDataCleaner-368"><span class="linenos">368</span></a><span class="sd">                Equivalent to Panda&#39;s how argument for the merge function. Only &#39;inner&#39; or &#39;left&#39; are allowed, since the </span>
</span><span id="MicronsDataCleaner-369"><a href="#MicronsDataCleaner-369"><span class="linenos">369</span></a><span class="sd">                new columns are always added into the nucleus table.</span>
</span><span id="MicronsDataCleaner-370"><a href="#MicronsDataCleaner-370"><span class="linenos">370</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-371"><a href="#MicronsDataCleaner-371"><span class="linenos">371</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner-372"><a href="#MicronsDataCleaner-372"><span class="linenos">372</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner-373"><a href="#MicronsDataCleaner-373"><span class="linenos">373</span></a><span class="sd">            pandas.DataFrame</span>
</span><span id="MicronsDataCleaner-374"><a href="#MicronsDataCleaner-374"><span class="linenos">374</span></a><span class="sd">                The merged DataFrame with the newly added columns.</span>
</span><span id="MicronsDataCleaner-375"><a href="#MicronsDataCleaner-375"><span class="linenos">375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-376"><a href="#MicronsDataCleaner-376"><span class="linenos">376</span></a>        
</span><span id="MicronsDataCleaner-377"><a href="#MicronsDataCleaner-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_columns</span><span class="p">(</span><span class="n">unit_table</span><span class="p">,</span> <span class="n">new_table</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">how</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-378"><a href="#MicronsDataCleaner-378"><span class="linenos">378</span></a>
</span><span id="MicronsDataCleaner-379"><a href="#MicronsDataCleaner-379"><span class="linenos">379</span></a>    
</span><span id="MicronsDataCleaner-380"><a href="#MicronsDataCleaner-380"><span class="linenos">380</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_nucleus_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">functional_data</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">):</span>
</span><span id="MicronsDataCleaner-381"><a href="#MicronsDataCleaner-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-382"><a href="#MicronsDataCleaner-382"><span class="linenos">382</span></a><span class="sd">        Processes downloaded data to generate a final, annotated unit table.</span>
</span><span id="MicronsDataCleaner-383"><a href="#MicronsDataCleaner-383"><span class="linenos">383</span></a><span class="sd">        It reads all previously downloaded nucleus-related tables (cell type,</span>
</span><span id="MicronsDataCleaner-384"><a href="#MicronsDataCleaner-384"><span class="linenos">384</span></a><span class="sd">        proofreading, brain area, etc.), merges them sequentially, transforms</span>
</span><span id="MicronsDataCleaner-385"><a href="#MicronsDataCleaner-385"><span class="linenos">385</span></a><span class="sd">        coordinates, performs cortical layer segmentation, and optionally</span>
</span><span id="MicronsDataCleaner-386"><a href="#MicronsDataCleaner-386"><span class="linenos">386</span></a><span class="sd">        integrates functional data based on the chosen strategy.</span>
</span><span id="MicronsDataCleaner-387"><a href="#MicronsDataCleaner-387"><span class="linenos">387</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-388"><a href="#MicronsDataCleaner-388"><span class="linenos">388</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner-389"><a href="#MicronsDataCleaner-389"><span class="linenos">389</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner-390"><a href="#MicronsDataCleaner-390"><span class="linenos">390</span></a><span class="sd">            functional_data: {&#39;none&#39;, &#39;match&#39;, &#39;all&#39;, &#39;best_only&#39;}, optional</span>
</span><span id="MicronsDataCleaner-391"><a href="#MicronsDataCleaner-391"><span class="linenos">391</span></a><span class="sd">                Specifies how to integrate functional data, by default &#39;none&#39;.</span>
</span><span id="MicronsDataCleaner-392"><a href="#MicronsDataCleaner-392"><span class="linenos">392</span></a><span class="sd">                - &#39;none&#39;: No functional data is added.</span>
</span><span id="MicronsDataCleaner-393"><a href="#MicronsDataCleaner-393"><span class="linenos">393</span></a><span class="sd">                - &#39;match&#39;: Adds columns (`session`, `scan_idx`, `functional_unit_id`)</span>
</span><span id="MicronsDataCleaner-394"><a href="#MicronsDataCleaner-394"><span class="linenos">394</span></a><span class="sd">                  to allow matching units with their corresponding functional scans.</span>
</span><span id="MicronsDataCleaner-395"><a href="#MicronsDataCleaner-395"><span class="linenos">395</span></a><span class="sd">                - &#39;all&#39;: Merges functional data from all available scans for each unit,</span>
</span><span id="MicronsDataCleaner-396"><a href="#MicronsDataCleaner-396"><span class="linenos">396</span></a><span class="sd">                  potentially resulting in multiple rows per unit.</span>
</span><span id="MicronsDataCleaner-397"><a href="#MicronsDataCleaner-397"><span class="linenos">397</span></a><span class="sd">                - &#39;best_only&#39;: Merges data only from the scan with the highest</span>
</span><span id="MicronsDataCleaner-398"><a href="#MicronsDataCleaner-398"><span class="linenos">398</span></a><span class="sd">                  performance metric (`cc_abs`) for each unit.</span>
</span><span id="MicronsDataCleaner-399"><a href="#MicronsDataCleaner-399"><span class="linenos">399</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner-400"><a href="#MicronsDataCleaner-400"><span class="linenos">400</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner-401"><a href="#MicronsDataCleaner-401"><span class="linenos">401</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner-402"><a href="#MicronsDataCleaner-402"><span class="linenos">402</span></a><span class="sd">            nucleus_merged: pandas.DataFrame</span>
</span><span id="MicronsDataCleaner-403"><a href="#MicronsDataCleaner-403"><span class="linenos">403</span></a><span class="sd">                The primary, processed unit table with all annotations, including</span>
</span><span id="MicronsDataCleaner-404"><a href="#MicronsDataCleaner-404"><span class="linenos">404</span></a><span class="sd">                cell type, proofreading status, brain area, cortical layer, and</span>
</span><span id="MicronsDataCleaner-405"><a href="#MicronsDataCleaner-405"><span class="linenos">405</span></a><span class="sd">                optionally functional properties.</span>
</span><span id="MicronsDataCleaner-406"><a href="#MicronsDataCleaner-406"><span class="linenos">406</span></a><span class="sd">            segments: pandas.DataFrame</span>
</span><span id="MicronsDataCleaner-407"><a href="#MicronsDataCleaner-407"><span class="linenos">407</span></a><span class="sd">                A DataFrame detailing the calculated cortical layer segments,</span>
</span><span id="MicronsDataCleaner-408"><a href="#MicronsDataCleaner-408"><span class="linenos">408</span></a><span class="sd">                including their start and end coordinates.</span>
</span><span id="MicronsDataCleaner-409"><a href="#MicronsDataCleaner-409"><span class="linenos">409</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner-410"><a href="#MicronsDataCleaner-410"><span class="linenos">410</span></a>        
</span><span id="MicronsDataCleaner-411"><a href="#MicronsDataCleaner-411"><span class="linenos">411</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing nucleus data with functional data option: &#39;</span><span class="si">{</span><span class="n">functional_data</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-412"><a href="#MicronsDataCleaner-412"><span class="linenos">412</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-413"><a href="#MicronsDataCleaner-413"><span class="linenos">413</span></a>
</span><span id="MicronsDataCleaner-414"><a href="#MicronsDataCleaner-414"><span class="linenos">414</span></a>            <span class="c1"># Read all the downloaded data</span>
</span><span id="MicronsDataCleaner-415"><a href="#MicronsDataCleaner-415"><span class="linenos">415</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Reading downloaded data files.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-416"><a href="#MicronsDataCleaner-416"><span class="linenos">416</span></a>            <span class="n">nucleus</span>   <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;nucleus&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-417"><a href="#MicronsDataCleaner-417"><span class="linenos">417</span></a>            <span class="n">celltype</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;celltype&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-418"><a href="#MicronsDataCleaner-418"><span class="linenos">418</span></a>            <span class="n">proofread</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;proofreading&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-419"><a href="#MicronsDataCleaner-419"><span class="linenos">419</span></a>            <span class="n">areas</span>     <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;brain_areas&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-420"><a href="#MicronsDataCleaner-420"><span class="linenos">420</span></a>
</span><span id="MicronsDataCleaner-421"><a href="#MicronsDataCleaner-421"><span class="linenos">421</span></a>            <span class="c1"># Use a better index for the global id</span>
</span><span id="MicronsDataCleaner-422"><a href="#MicronsDataCleaner-422"><span class="linenos">422</span></a>            <span class="n">nucleus</span> <span class="o">=</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span> <span class="p">:</span> <span class="s1">&#39;nucleus_id&#39;</span><span class="p">})</span>
</span><span id="MicronsDataCleaner-423"><a href="#MicronsDataCleaner-423"><span class="linenos">423</span></a>
</span><span id="MicronsDataCleaner-424"><a href="#MicronsDataCleaner-424"><span class="linenos">424</span></a>            <span class="c1"># Load functional data depending on user preferences</span>
</span><span id="MicronsDataCleaner-425"><a href="#MicronsDataCleaner-425"><span class="linenos">425</span></a>            <span class="k">if</span> <span class="n">functional_data</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;best_only&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]:</span> 
</span><span id="MicronsDataCleaner-426"><a href="#MicronsDataCleaner-426"><span class="linenos">426</span></a>                <span class="n">funcprops</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;func_props&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-427"><a href="#MicronsDataCleaner-427"><span class="linenos">427</span></a>            <span class="k">elif</span> <span class="n">functional_data</span> <span class="o">==</span> <span class="s1">&#39;match&#39;</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-428"><a href="#MicronsDataCleaner-428"><span class="linenos">428</span></a>                <span class="n">coreg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;coreg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-429"><a href="#MicronsDataCleaner-429"><span class="linenos">429</span></a>
</span><span id="MicronsDataCleaner-430"><a href="#MicronsDataCleaner-430"><span class="linenos">430</span></a>            <span class="c1"># Call all the merge functions. First, cell types</span>
</span><span id="MicronsDataCleaner-431"><a href="#MicronsDataCleaner-431"><span class="linenos">431</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Merging nucleus data with cell types.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-432"><a href="#MicronsDataCleaner-432"><span class="linenos">432</span></a>            <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_nucleus_with_cell_types</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">celltype</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-433"><a href="#MicronsDataCleaner-433"><span class="linenos">433</span></a>
</span><span id="MicronsDataCleaner-434"><a href="#MicronsDataCleaner-434"><span class="linenos">434</span></a>            <span class="c1"># Then, brain area. </span>
</span><span id="MicronsDataCleaner-435"><a href="#MicronsDataCleaner-435"><span class="linenos">435</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Merging brain area information.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-436"><a href="#MicronsDataCleaner-436"><span class="linenos">436</span></a>            <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_brain_area</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">,</span> <span class="n">areas</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-437"><a href="#MicronsDataCleaner-437"><span class="linenos">437</span></a>
</span><span id="MicronsDataCleaner-438"><a href="#MicronsDataCleaner-438"><span class="linenos">438</span></a>            <span class="c1"># Proofreading info</span>
</span><span id="MicronsDataCleaner-439"><a href="#MicronsDataCleaner-439"><span class="linenos">439</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Merging proofreading status.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-440"><a href="#MicronsDataCleaner-440"><span class="linenos">440</span></a>            <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_proofreading_status</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">,</span> <span class="n">proofread</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-441"><a href="#MicronsDataCleaner-441"><span class="linenos">441</span></a>
</span><span id="MicronsDataCleaner-442"><a href="#MicronsDataCleaner-442"><span class="linenos">442</span></a>            <span class="c1"># Get the correct positions</span>
</span><span id="MicronsDataCleaner-443"><a href="#MicronsDataCleaner-443"><span class="linenos">443</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Transforming positions.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-444"><a href="#MicronsDataCleaner-444"><span class="linenos">444</span></a>            <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">transform_positions</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-445"><a href="#MicronsDataCleaner-445"><span class="linenos">445</span></a>
</span><span id="MicronsDataCleaner-446"><a href="#MicronsDataCleaner-446"><span class="linenos">446</span></a>            <span class="c1"># Segment the data and add the information about layers</span>
</span><span id="MicronsDataCleaner-447"><a href="#MicronsDataCleaner-447"><span class="linenos">447</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Segmenting volume and adding layer info.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-448"><a href="#MicronsDataCleaner-448"><span class="linenos">448</span></a>            <span class="n">segments</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">divide_volume_into_segments</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-449"><a href="#MicronsDataCleaner-449"><span class="linenos">449</span></a>            <span class="n">segments</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_segments_by_layer</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-450"><a href="#MicronsDataCleaner-450"><span class="linenos">450</span></a>
</span><span id="MicronsDataCleaner-451"><a href="#MicronsDataCleaner-451"><span class="linenos">451</span></a>            <span class="n">proc</span><span class="o">.</span><span class="n">add_layer_info</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">,</span> <span class="n">segments</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-452"><a href="#MicronsDataCleaner-452"><span class="linenos">452</span></a>
</span><span id="MicronsDataCleaner-453"><a href="#MicronsDataCleaner-453"><span class="linenos">453</span></a>            <span class="c1"># Clean the resulting table by eliminating all multisoma objects. </span>
</span><span id="MicronsDataCleaner-454"><a href="#MicronsDataCleaner-454"><span class="linenos">454</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleaning table: removing multisoma objects and duplicates.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-455"><a href="#MicronsDataCleaner-455"><span class="linenos">455</span></a>            <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">nucleus_merged</span><span class="p">[</span><span class="n">nucleus_merged</span><span class="p">[</span><span class="s1">&#39;pt_root_id&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="MicronsDataCleaner-456"><a href="#MicronsDataCleaner-456"><span class="linenos">456</span></a>            <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">nucleus_merged</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;pt_root_id&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-457"><a href="#MicronsDataCleaner-457"><span class="linenos">457</span></a>
</span><span id="MicronsDataCleaner-458"><a href="#MicronsDataCleaner-458"><span class="linenos">458</span></a>
</span><span id="MicronsDataCleaner-459"><a href="#MicronsDataCleaner-459"><span class="linenos">459</span></a>            <span class="c1"># Finally, functional properties. </span>
</span><span id="MicronsDataCleaner-460"><a href="#MicronsDataCleaner-460"><span class="linenos">460</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding functional information&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-461"><a href="#MicronsDataCleaner-461"><span class="linenos">461</span></a>            <span class="k">if</span> <span class="n">functional_data</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;best_only&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]:</span> 
</span><span id="MicronsDataCleaner-462"><a href="#MicronsDataCleaner-462"><span class="linenos">462</span></a>                <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_functional_properties</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">,</span> <span class="n">funcprops</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">functional_data</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-463"><a href="#MicronsDataCleaner-463"><span class="linenos">463</span></a>                <span class="n">nucleus_merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nucleus_merged</span><span class="p">[</span><span class="s1">&#39;tuning_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;tuning_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_matched&#39;</span>
</span><span id="MicronsDataCleaner-464"><a href="#MicronsDataCleaner-464"><span class="linenos">464</span></a>            <span class="k">elif</span> <span class="n">functional_data</span> <span class="o">==</span> <span class="s1">&#39;match&#39;</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-465"><a href="#MicronsDataCleaner-465"><span class="linenos">465</span></a>                <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_functional_properties</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">,</span> <span class="n">coreg</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">functional_data</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-466"><a href="#MicronsDataCleaner-466"><span class="linenos">466</span></a>                <span class="n">nucleus_merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nucleus_merged</span><span class="p">[</span><span class="s1">&#39;tuning_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;tuning_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_matched&#39;</span>
</span><span id="MicronsDataCleaner-467"><a href="#MicronsDataCleaner-467"><span class="linenos">467</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-468"><a href="#MicronsDataCleaner-468"><span class="linenos">468</span></a>                <span class="n">nucleus_merged</span><span class="p">[</span><span class="s1">&#39;tuning_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_matched&#39;</span>
</span><span id="MicronsDataCleaner-469"><a href="#MicronsDataCleaner-469"><span class="linenos">469</span></a>
</span><span id="MicronsDataCleaner-470"><a href="#MicronsDataCleaner-470"><span class="linenos">470</span></a>            <span class="k">return</span> <span class="n">nucleus_merged</span><span class="p">,</span> <span class="n">segments</span>
</span><span id="MicronsDataCleaner-471"><a href="#MicronsDataCleaner-471"><span class="linenos">471</span></a>
</span><span id="MicronsDataCleaner-472"><a href="#MicronsDataCleaner-472"><span class="linenos">472</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-473"><a href="#MicronsDataCleaner-473"><span class="linenos">473</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Required data file not found: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner-474"><a href="#MicronsDataCleaner-474"><span class="linenos">474</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MicronsDataCleaner-475"><a href="#MicronsDataCleaner-475"><span class="linenos">475</span></a>            <span class="k">raise</span> <span class="n">e</span> 
</span></pre></div>


            <div class="docstring"><p>The main class to download and clean data from the Microns Dataset.</p>
</div>


                            <div id="MicronsDataCleaner.__init__" class="classattr">
                                        <input id="MicronsDataCleaner.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MicronsDataCleaner</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">datadir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span>,</span><span class="param">	<span class="n">version</span><span class="o">=</span><span class="mi">1300</span>,</span><span class="param">	<span class="n">download_policy</span><span class="o">=</span><span class="s1">&#39;minimum&#39;</span>,</span><span class="param">	<span class="n">extra_tables</span><span class="o">=</span><span class="p">[]</span></span>)</span>

                <label class="view-source-button" for="MicronsDataCleaner.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MicronsDataCleaner.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MicronsDataCleaner.__init__-36"><a href="#MicronsDataCleaner.__init__-36"><span class="linenos">36</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1300</span><span class="p">,</span> <span class="n">download_policy</span><span class="o">=</span><span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="n">extra_tables</span><span class="o">=</span><span class="p">[]):</span>
</span><span id="MicronsDataCleaner.__init__-37"><a href="#MicronsDataCleaner.__init__-37"><span class="linenos">37</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.__init__-38"><a href="#MicronsDataCleaner.__init__-38"><span class="linenos">38</span></a><span class="sd">        Initialize the class and makes sure subfolders to download exist. Configures the tables to be downloaded (except synapses) via</span>
</span><span id="MicronsDataCleaner.__init__-39"><a href="#MicronsDataCleaner.__init__-39"><span class="linenos">39</span></a><span class="sd">        a download policy.</span>
</span><span id="MicronsDataCleaner.__init__-40"><a href="#MicronsDataCleaner.__init__-40"><span class="linenos">40</span></a>
</span><span id="MicronsDataCleaner.__init__-41"><a href="#MicronsDataCleaner.__init__-41"><span class="linenos">41</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner.__init__-42"><a href="#MicronsDataCleaner.__init__-42"><span class="linenos">42</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner.__init__-43"><a href="#MicronsDataCleaner.__init__-43"><span class="linenos">43</span></a><span class="sd">            datadir: string, optional</span>
</span><span id="MicronsDataCleaner.__init__-44"><a href="#MicronsDataCleaner.__init__-44"><span class="linenos">44</span></a><span class="sd">                Defaults to &#39;data&#39;. Points to the folder where information will be downloaded.</span>
</span><span id="MicronsDataCleaner.__init__-45"><a href="#MicronsDataCleaner.__init__-45"><span class="linenos">45</span></a><span class="sd">            custom_tables: dict, optional </span>
</span><span id="MicronsDataCleaner.__init__-46"><a href="#MicronsDataCleaner.__init__-46"><span class="linenos">46</span></a><span class="sd">                Used to override the default tables used to construct the unit table in a given version. The keys for the tables</span>
</span><span id="MicronsDataCleaner.__init__-47"><a href="#MicronsDataCleaner.__init__-47"><span class="linenos">47</span></a><span class="sd">                to be overrided are &#39;celltype&#39; for the nucleus classification scheme, &#39;proofreading&#39; for the prooreading table,</span>
</span><span id="MicronsDataCleaner.__init__-48"><a href="#MicronsDataCleaner.__init__-48"><span class="linenos">48</span></a><span class="sd">                &#39;brain_areas&#39; for assigned brain areas, &#39;func_props&#39; for functional properties, and &#39;coreg&#39; for the coregistration table.</span>
</span><span id="MicronsDataCleaner.__init__-49"><a href="#MicronsDataCleaner.__init__-49"><span class="linenos">49</span></a><span class="sd">            download_policy: str, optional</span>
</span><span id="MicronsDataCleaner.__init__-50"><a href="#MicronsDataCleaner.__init__-50"><span class="linenos">50</span></a><span class="sd">                Used to set how the tables should be downloaded. &#39;minimum&#39; (the default) only downloads the minimum amount of tables necessary </span>
</span><span id="MicronsDataCleaner.__init__-51"><a href="#MicronsDataCleaner.__init__-51"><span class="linenos">51</span></a><span class="sd">                to construct our unit table. &#39;all&#39; gets all of them. &#39;extra&#39; gets the same as &#39;minimum&#39; plus the tables specified in `extra_tables`.</span>
</span><span id="MicronsDataCleaner.__init__-52"><a href="#MicronsDataCleaner.__init__-52"><span class="linenos">52</span></a><span class="sd">            extra_tables: list, optional</span>
</span><span id="MicronsDataCleaner.__init__-53"><a href="#MicronsDataCleaner.__init__-53"><span class="linenos">53</span></a><span class="sd">                List of extra table names to be downloaded. See the download_police for more information.</span>
</span><span id="MicronsDataCleaner.__init__-54"><a href="#MicronsDataCleaner.__init__-54"><span class="linenos">54</span></a>
</span><span id="MicronsDataCleaner.__init__-55"><a href="#MicronsDataCleaner.__init__-55"><span class="linenos">55</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner.__init__-56"><a href="#MicronsDataCleaner.__init__-56"><span class="linenos">56</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner.__init__-57"><a href="#MicronsDataCleaner.__init__-57"><span class="linenos">57</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner.__init__-58"><a href="#MicronsDataCleaner.__init__-58"><span class="linenos">58</span></a><span class="sd">                This method is a constructor and does not return any value.</span>
</span><span id="MicronsDataCleaner.__init__-59"><a href="#MicronsDataCleaner.__init__-59"><span class="linenos">59</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.__init__-60"><a href="#MicronsDataCleaner.__init__-60"><span class="linenos">60</span></a>        
</span><span id="MicronsDataCleaner.__init__-61"><a href="#MicronsDataCleaner.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
</span><span id="MicronsDataCleaner.__init__-62"><a href="#MicronsDataCleaner.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datadir</span> <span class="o">=</span> <span class="n">datadir</span>
</span><span id="MicronsDataCleaner.__init__-63"><a href="#MicronsDataCleaner.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">homedir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MicronsDataCleaner.__init__-64"><a href="#MicronsDataCleaner.__init__-64"><span class="linenos">64</span></a>
</span><span id="MicronsDataCleaner.__init__-65"><a href="#MicronsDataCleaner.__init__-65"><span class="linenos">65</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data will be stored in: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.__init__-66"><a href="#MicronsDataCleaner.__init__-66"><span class="linenos">66</span></a>
</span><span id="MicronsDataCleaner.__init__-67"><a href="#MicronsDataCleaner.__init__-67"><span class="linenos">67</span></a>        <span class="c1"># Ensure directories exist</span>
</span><span id="MicronsDataCleaner.__init__-68"><a href="#MicronsDataCleaner.__init__-68"><span class="linenos">68</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.__init__-69"><a href="#MicronsDataCleaner.__init__-69"><span class="linenos">69</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.__init__-70"><a href="#MicronsDataCleaner.__init__-70"><span class="linenos">70</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/synapses&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.__init__-71"><a href="#MicronsDataCleaner.__init__-71"><span class="linenos">71</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Data directories created successfully.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.__init__-72"><a href="#MicronsDataCleaner.__init__-72"><span class="linenos">72</span></a>
</span><span id="MicronsDataCleaner.__init__-73"><a href="#MicronsDataCleaner.__init__-73"><span class="linenos">73</span></a>        <span class="c1"># Initialize the CAVEClient with the user-specified version </span>
</span><span id="MicronsDataCleaner.__init__-74"><a href="#MicronsDataCleaner.__init__-74"><span class="linenos">74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_client</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.__init__-75"><a href="#MicronsDataCleaner.__init__-75"><span class="linenos">75</span></a>
</span><span id="MicronsDataCleaner.__init__-76"><a href="#MicronsDataCleaner.__init__-76"><span class="linenos">76</span></a>        <span class="c1"># Set the tables to download according to the version</span>
</span><span id="MicronsDataCleaner.__init__-77"><a href="#MicronsDataCleaner.__init__-77"><span class="linenos">77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_configure_download_tables</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">download_policy</span><span class="p">,</span> <span class="n">extra_tables</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the class and makes sure subfolders to download exist. Configures the tables to be downloaded (except synapses) via
a download policy.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>datadir: string, optional
    Defaults to 'data'. Points to the folder where information will be downloaded.
custom_tables: dict, optional 
    Used to override the default tables used to construct the unit table in a given version. The keys for the tables
    to be overrided are 'celltype' for the nucleus classification scheme, 'proofreading' for the prooreading table,
    'brain_areas' for assigned brain areas, 'func_props' for functional properties, and 'coreg' for the coregistration table.
download_policy: str, optional
    Used to set how the tables should be downloaded. 'minimum' (the default) only downloads the minimum amount of tables necessary 
    to construct our unit table. 'all' gets all of them. 'extra' gets the same as 'minimum' plus the tables specified in `extra_tables`.
extra_tables: list, optional
    List of extra table names to be downloaded. See the download_police for more information.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>None.
    This method is a constructor and does not return any value.
</code></pre>
</div>


                            </div>
                            <div id="MicronsDataCleaner.homedir" class="classattr">
                                <div class="attr variable">
            <span class="name">homedir</span>        =
<span class="default_value">PosixPath(&#39;/home/victor/Fisica/Research/Milan/MICrONS-datacleaner&#39;)</span>

        
    </div>
    <a class="headerlink" href="#MicronsDataCleaner.homedir"></a>
    
            <div class="docstring"><p>Subfolder aimed to contain the downloaded data</p>
</div>


                            </div>
                            <div id="MicronsDataCleaner.datadir" class="classattr">
                                <div class="attr variable">
            <span class="name">datadir</span>        =
<span class="default_value">&#39;data&#39;</span>

        
    </div>
    <a class="headerlink" href="#MicronsDataCleaner.datadir"></a>
    
            <div class="docstring"><p>Version of the client we are using</p>
</div>


                            </div>
                            <div id="MicronsDataCleaner.version" class="classattr">
                                <div class="attr variable">
            <span class="name">version</span>        =
<span class="default_value">1300</span>

        
    </div>
    <a class="headerlink" href="#MicronsDataCleaner.version"></a>
    
    

                            </div>
                            <div id="MicronsDataCleaner.data_storage" class="classattr">
                                <div class="attr variable">
            <span class="name">data_storage</span>

        
    </div>
    <a class="headerlink" href="#MicronsDataCleaner.data_storage"></a>
    
    

                            </div>
                            <div id="MicronsDataCleaner.download_functional_fits" class="classattr">
                                        <input id="MicronsDataCleaner.download_functional_fits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">download_functional_fits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">foldername</span><span class="o">=</span><span class="s1">&#39;functional&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MicronsDataCleaner.download_functional_fits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MicronsDataCleaner.download_functional_fits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MicronsDataCleaner.download_functional_fits-137"><a href="#MicronsDataCleaner.download_functional_fits-137"><span class="linenos">137</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_functional_fits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foldername</span><span class="o">=</span><span class="s2">&quot;functional&quot;</span><span class="p">):</span>
</span><span id="MicronsDataCleaner.download_functional_fits-138"><a href="#MicronsDataCleaner.download_functional_fits-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.download_functional_fits-139"><a href="#MicronsDataCleaner.download_functional_fits-139"><span class="linenos">139</span></a><span class="sd">        Downloads functional tuning curves and fits from Zenodo.</span>
</span><span id="MicronsDataCleaner.download_functional_fits-140"><a href="#MicronsDataCleaner.download_functional_fits-140"><span class="linenos">140</span></a><span class="sd">        This convenience method downloads a pre-processed data file containing</span>
</span><span id="MicronsDataCleaner.download_functional_fits-141"><a href="#MicronsDataCleaner.download_functional_fits-141"><span class="linenos">141</span></a><span class="sd">        functional tuning curves and their fits. The data is hosted on Zenodo</span>
</span><span id="MicronsDataCleaner.download_functional_fits-142"><a href="#MicronsDataCleaner.download_functional_fits-142"><span class="linenos">142</span></a><span class="sd">        and has been specifically prepared for use with this package. The method</span>
</span><span id="MicronsDataCleaner.download_functional_fits-143"><a href="#MicronsDataCleaner.download_functional_fits-143"><span class="linenos">143</span></a><span class="sd">        handles the creation of the destination folder before initiating the download.</span>
</span><span id="MicronsDataCleaner.download_functional_fits-144"><a href="#MicronsDataCleaner.download_functional_fits-144"><span class="linenos">144</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner.download_functional_fits-145"><a href="#MicronsDataCleaner.download_functional_fits-145"><span class="linenos">145</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner.download_functional_fits-146"><a href="#MicronsDataCleaner.download_functional_fits-146"><span class="linenos">146</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner.download_functional_fits-147"><a href="#MicronsDataCleaner.download_functional_fits-147"><span class="linenos">147</span></a><span class="sd">        - **foldername : *str, optional***</span>
</span><span id="MicronsDataCleaner.download_functional_fits-148"><a href="#MicronsDataCleaner.download_functional_fits-148"><span class="linenos">148</span></a>
</span><span id="MicronsDataCleaner.download_functional_fits-149"><a href="#MicronsDataCleaner.download_functional_fits-149"><span class="linenos">149</span></a><span class="sd">            The name of the subfolder within the main data directory where the</span>
</span><span id="MicronsDataCleaner.download_functional_fits-150"><a href="#MicronsDataCleaner.download_functional_fits-150"><span class="linenos">150</span></a><span class="sd">            data will be saved, by default &quot;functional&quot;. If this folder does</span>
</span><span id="MicronsDataCleaner.download_functional_fits-151"><a href="#MicronsDataCleaner.download_functional_fits-151"><span class="linenos">151</span></a><span class="sd">            not exist, it will be created.</span>
</span><span id="MicronsDataCleaner.download_functional_fits-152"><a href="#MicronsDataCleaner.download_functional_fits-152"><span class="linenos">152</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner.download_functional_fits-153"><a href="#MicronsDataCleaner.download_functional_fits-153"><span class="linenos">153</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner.download_functional_fits-154"><a href="#MicronsDataCleaner.download_functional_fits-154"><span class="linenos">154</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner.download_functional_fits-155"><a href="#MicronsDataCleaner.download_functional_fits-155"><span class="linenos">155</span></a><span class="sd">        - **None.**</span>
</span><span id="MicronsDataCleaner.download_functional_fits-156"><a href="#MicronsDataCleaner.download_functional_fits-156"><span class="linenos">156</span></a>
</span><span id="MicronsDataCleaner.download_functional_fits-157"><a href="#MicronsDataCleaner.download_functional_fits-157"><span class="linenos">157</span></a><span class="sd">            This method does not return a value. It saves the downloaded data to</span>
</span><span id="MicronsDataCleaner.download_functional_fits-158"><a href="#MicronsDataCleaner.download_functional_fits-158"><span class="linenos">158</span></a><span class="sd">            a file named &#39;tuning_curves_fitted_v1.csv&#39; inside the specified folder.</span>
</span><span id="MicronsDataCleaner.download_functional_fits-159"><a href="#MicronsDataCleaner.download_functional_fits-159"><span class="linenos">159</span></a>
</span><span id="MicronsDataCleaner.download_functional_fits-160"><a href="#MicronsDataCleaner.download_functional_fits-160"><span class="linenos">160</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.download_functional_fits-161"><a href="#MicronsDataCleaner.download_functional_fits-161"><span class="linenos">161</span></a>
</span><span id="MicronsDataCleaner.download_functional_fits-162"><a href="#MicronsDataCleaner.download_functional_fits-162"><span class="linenos">162</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">homedir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">foldername</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.download_functional_fits-163"><a href="#MicronsDataCleaner.download_functional_fits-163"><span class="linenos">163</span></a>        <span class="n">down</span><span class="o">.</span><span class="n">download_functional_fits</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">homedir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">foldername</span><span class="si">}</span><span class="s2">/tuning_curves_fitted_v1.csv&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Downloads functional tuning curves and fits from Zenodo.
This convenience method downloads a pre-processed data file containing
functional tuning curves and their fits. The data is hosted on Zenodo
and has been specifically prepared for use with this package. The method
handles the creation of the destination folder before initiating the download.</p>

<h2 id="parameters">Parameters:</h2>

<ul>
<li><p><strong>foldername : <em>str, optional</em></strong></p>

<p>The name of the subfolder within the main data directory where the
data will be saved, by default "functional". If this folder does
not exist, it will be created.</p></li>
</ul>

<h2 id="returns">Returns:</h2>

<ul>
<li><p><strong>None.</strong></p>

<p>This method does not return a value. It saves the downloaded data to
a file named 'tuning_curves_fitted_v1.csv' inside the specified folder.</p></li>
</ul>
</div>


                            </div>
                            <div id="MicronsDataCleaner.get_table_list" class="classattr">
                                        <input id="MicronsDataCleaner.get_table_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_table_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MicronsDataCleaner.get_table_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MicronsDataCleaner.get_table_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MicronsDataCleaner.get_table_list-202"><a href="#MicronsDataCleaner.get_table_list-202"><span class="linenos">202</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_table_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MicronsDataCleaner.get_table_list-203"><a href="#MicronsDataCleaner.get_table_list-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.get_table_list-204"><a href="#MicronsDataCleaner.get_table_list-204"><span class="linenos">204</span></a><span class="sd">        Retrieves a list of all available tables for the current version.</span>
</span><span id="MicronsDataCleaner.get_table_list-205"><a href="#MicronsDataCleaner.get_table_list-205"><span class="linenos">205</span></a><span class="sd">        This method queries the CAVEclient to get the names of all tables</span>
</span><span id="MicronsDataCleaner.get_table_list-206"><a href="#MicronsDataCleaner.get_table_list-206"><span class="linenos">206</span></a><span class="sd">        available in the currently configured materialization version.</span>
</span><span id="MicronsDataCleaner.get_table_list-207"><a href="#MicronsDataCleaner.get_table_list-207"><span class="linenos">207</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner.get_table_list-208"><a href="#MicronsDataCleaner.get_table_list-208"><span class="linenos">208</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner.get_table_list-209"><a href="#MicronsDataCleaner.get_table_list-209"><span class="linenos">209</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner.get_table_list-210"><a href="#MicronsDataCleaner.get_table_list-210"><span class="linenos">210</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner.get_table_list-211"><a href="#MicronsDataCleaner.get_table_list-211"><span class="linenos">211</span></a><span class="sd">            </span>
</span><span id="MicronsDataCleaner.get_table_list-212"><a href="#MicronsDataCleaner.get_table_list-212"><span class="linenos">212</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner.get_table_list-213"><a href="#MicronsDataCleaner.get_table_list-213"><span class="linenos">213</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner.get_table_list-214"><a href="#MicronsDataCleaner.get_table_list-214"><span class="linenos">214</span></a><span class="sd">            list[str]</span>
</span><span id="MicronsDataCleaner.get_table_list-215"><a href="#MicronsDataCleaner.get_table_list-215"><span class="linenos">215</span></a><span class="sd">                A list of strings, where each string is the name of an available</span>
</span><span id="MicronsDataCleaner.get_table_list-216"><a href="#MicronsDataCleaner.get_table_list-216"><span class="linenos">216</span></a><span class="sd">                table in the dataset.</span>
</span><span id="MicronsDataCleaner.get_table_list-217"><a href="#MicronsDataCleaner.get_table_list-217"><span class="linenos">217</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.get_table_list-218"><a href="#MicronsDataCleaner.get_table_list-218"><span class="linenos">218</span></a>
</span><span id="MicronsDataCleaner.get_table_list-219"><a href="#MicronsDataCleaner.get_table_list-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">materialize</span><span class="o">.</span><span class="n">get_tables</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves a list of all available tables for the current version.
This method queries the CAVEclient to get the names of all tables
available in the currently configured materialization version.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>None.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>list[str]
    A list of strings, where each string is the name of an available
    table in the dataset.
</code></pre>
</div>


                            </div>
                            <div id="MicronsDataCleaner.read_table" class="classattr">
                                        <input id="MicronsDataCleaner.read_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_table</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">table_name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MicronsDataCleaner.read_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MicronsDataCleaner.read_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MicronsDataCleaner.read_table-222"><a href="#MicronsDataCleaner.read_table-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
</span><span id="MicronsDataCleaner.read_table-223"><a href="#MicronsDataCleaner.read_table-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.read_table-224"><a href="#MicronsDataCleaner.read_table-224"><span class="linenos">224</span></a><span class="sd">        Reads a specified table from a local CSV file into a pandas DataFrame.</span>
</span><span id="MicronsDataCleaner.read_table-225"><a href="#MicronsDataCleaner.read_table-225"><span class="linenos">225</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner.read_table-226"><a href="#MicronsDataCleaner.read_table-226"><span class="linenos">226</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner.read_table-227"><a href="#MicronsDataCleaner.read_table-227"><span class="linenos">227</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner.read_table-228"><a href="#MicronsDataCleaner.read_table-228"><span class="linenos">228</span></a><span class="sd">            table_name: str</span>
</span><span id="MicronsDataCleaner.read_table-229"><a href="#MicronsDataCleaner.read_table-229"><span class="linenos">229</span></a><span class="sd">                The name of the table to read.</span>
</span><span id="MicronsDataCleaner.read_table-230"><a href="#MicronsDataCleaner.read_table-230"><span class="linenos">230</span></a>
</span><span id="MicronsDataCleaner.read_table-231"><a href="#MicronsDataCleaner.read_table-231"><span class="linenos">231</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner.read_table-232"><a href="#MicronsDataCleaner.read_table-232"><span class="linenos">232</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner.read_table-233"><a href="#MicronsDataCleaner.read_table-233"><span class="linenos">233</span></a><span class="sd">            pandas.DataFrame</span>
</span><span id="MicronsDataCleaner.read_table-234"><a href="#MicronsDataCleaner.read_table-234"><span class="linenos">234</span></a><span class="sd">                A DataFrame containing the data from the specified CSV file.</span>
</span><span id="MicronsDataCleaner.read_table-235"><a href="#MicronsDataCleaner.read_table-235"><span class="linenos">235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.read_table-236"><a href="#MicronsDataCleaner.read_table-236"><span class="linenos">236</span></a>
</span><span id="MicronsDataCleaner.read_table-237"><a href="#MicronsDataCleaner.read_table-237"><span class="linenos">237</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">table_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">):</span>
</span><span id="MicronsDataCleaner.read_table-238"><a href="#MicronsDataCleaner.read_table-238"><span class="linenos">238</span></a>            <span class="n">table_name</span> <span class="o">+=</span> <span class="s2">&quot;.csv&quot;</span>
</span><span id="MicronsDataCleaner.read_table-239"><a href="#MicronsDataCleaner.read_table-239"><span class="linenos">239</span></a>        
</span><span id="MicronsDataCleaner.read_table-240"><a href="#MicronsDataCleaner.read_table-240"><span class="linenos">240</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
</span></pre></div>


            <div class="docstring"><p>Reads a specified table from a local CSV file into a pandas DataFrame.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>table_name: str
    The name of the table to read.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>pandas.DataFrame
    A DataFrame containing the data from the specified CSV file.
</code></pre>
</div>


                            </div>
                            <div id="MicronsDataCleaner.download_nucleus_data" class="classattr">
                                        <input id="MicronsDataCleaner.download_nucleus_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">download_nucleus_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MicronsDataCleaner.download_nucleus_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MicronsDataCleaner.download_nucleus_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MicronsDataCleaner.download_nucleus_data-243"><a href="#MicronsDataCleaner.download_nucleus_data-243"><span class="linenos">243</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_nucleus_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-244"><a href="#MicronsDataCleaner.download_nucleus_data-244"><span class="linenos">244</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-245"><a href="#MicronsDataCleaner.download_nucleus_data-245"><span class="linenos">245</span></a><span class="sd">        Downloads all nucleus-related tables based on the initial configuration.</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-246"><a href="#MicronsDataCleaner.download_nucleus_data-246"><span class="linenos">246</span></a><span class="sd">        The specific tables downloaded depend on the `download_policy` chosen at initialization.</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-247"><a href="#MicronsDataCleaner.download_nucleus_data-247"><span class="linenos">247</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner.download_nucleus_data-248"><a href="#MicronsDataCleaner.download_nucleus_data-248"><span class="linenos">248</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-249"><a href="#MicronsDataCleaner.download_nucleus_data-249"><span class="linenos">249</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-250"><a href="#MicronsDataCleaner.download_nucleus_data-250"><span class="linenos">250</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-251"><a href="#MicronsDataCleaner.download_nucleus_data-251"><span class="linenos">251</span></a><span class="sd">            </span>
</span><span id="MicronsDataCleaner.download_nucleus_data-252"><a href="#MicronsDataCleaner.download_nucleus_data-252"><span class="linenos">252</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-253"><a href="#MicronsDataCleaner.download_nucleus_data-253"><span class="linenos">253</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-254"><a href="#MicronsDataCleaner.download_nucleus_data-254"><span class="linenos">254</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-255"><a href="#MicronsDataCleaner.download_nucleus_data-255"><span class="linenos">255</span></a><span class="sd">                This method does not return a value. It saves the downloaded tables</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-256"><a href="#MicronsDataCleaner.download_nucleus_data-256"><span class="linenos">256</span></a><span class="sd">                as CSV files in the `raw` data directory. </span>
</span><span id="MicronsDataCleaner.download_nucleus_data-257"><a href="#MicronsDataCleaner.download_nucleus_data-257"><span class="linenos">257</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-258"><a href="#MicronsDataCleaner.download_nucleus_data-258"><span class="linenos">258</span></a>
</span><span id="MicronsDataCleaner.download_nucleus_data-259"><a href="#MicronsDataCleaner.download_nucleus_data-259"><span class="linenos">259</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading nucleus data tables: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables_2_download</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-260"><a href="#MicronsDataCleaner.download_nucleus_data-260"><span class="linenos">260</span></a>        <span class="n">down</span><span class="o">.</span><span class="n">download_tables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">tables_2_download</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-261"><a href="#MicronsDataCleaner.download_nucleus_data-261"><span class="linenos">261</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Nucleus data download completed.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.download_nucleus_data-262"><a href="#MicronsDataCleaner.download_nucleus_data-262"><span class="linenos">262</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Downloads all nucleus-related tables based on the initial configuration.
The specific tables downloaded depend on the <code>download_policy</code> chosen at initialization.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>None.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>None.
    This method does not return a value. It saves the downloaded tables
    as CSV files in the `raw` data directory.
</code></pre>
</div>


                            </div>
                            <div id="MicronsDataCleaner.download_tables" class="classattr">
                                        <input id="MicronsDataCleaner.download_tables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">download_tables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">table_names</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MicronsDataCleaner.download_tables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MicronsDataCleaner.download_tables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MicronsDataCleaner.download_tables-265"><a href="#MicronsDataCleaner.download_tables-265"><span class="linenos">265</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_names</span><span class="p">):</span>
</span><span id="MicronsDataCleaner.download_tables-266"><a href="#MicronsDataCleaner.download_tables-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.download_tables-267"><a href="#MicronsDataCleaner.download_tables-267"><span class="linenos">267</span></a><span class="sd">        Downloads a user-specified list of tables.</span>
</span><span id="MicronsDataCleaner.download_tables-268"><a href="#MicronsDataCleaner.download_tables-268"><span class="linenos">268</span></a><span class="sd">        This method allows for downloading an arbitrary list of tables from the</span>
</span><span id="MicronsDataCleaner.download_tables-269"><a href="#MicronsDataCleaner.download_tables-269"><span class="linenos">269</span></a><span class="sd">        database, in addition to those specified by the download policy during</span>
</span><span id="MicronsDataCleaner.download_tables-270"><a href="#MicronsDataCleaner.download_tables-270"><span class="linenos">270</span></a><span class="sd">        initialization.</span>
</span><span id="MicronsDataCleaner.download_tables-271"><a href="#MicronsDataCleaner.download_tables-271"><span class="linenos">271</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner.download_tables-272"><a href="#MicronsDataCleaner.download_tables-272"><span class="linenos">272</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner.download_tables-273"><a href="#MicronsDataCleaner.download_tables-273"><span class="linenos">273</span></a><span class="sd">        ----------- </span>
</span><span id="MicronsDataCleaner.download_tables-274"><a href="#MicronsDataCleaner.download_tables-274"><span class="linenos">274</span></a><span class="sd">            table_names: list[str]</span>
</span><span id="MicronsDataCleaner.download_tables-275"><a href="#MicronsDataCleaner.download_tables-275"><span class="linenos">275</span></a><span class="sd">                A list containing the exact names of the tables to be downloaded.</span>
</span><span id="MicronsDataCleaner.download_tables-276"><a href="#MicronsDataCleaner.download_tables-276"><span class="linenos">276</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner.download_tables-277"><a href="#MicronsDataCleaner.download_tables-277"><span class="linenos">277</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner.download_tables-278"><a href="#MicronsDataCleaner.download_tables-278"><span class="linenos">278</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner.download_tables-279"><a href="#MicronsDataCleaner.download_tables-279"><span class="linenos">279</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner.download_tables-280"><a href="#MicronsDataCleaner.download_tables-280"><span class="linenos">280</span></a><span class="sd">                This method does not return a value. It saves the downloaded tables</span>
</span><span id="MicronsDataCleaner.download_tables-281"><a href="#MicronsDataCleaner.download_tables-281"><span class="linenos">281</span></a><span class="sd">                as CSV files in the `raw` data directory.</span>
</span><span id="MicronsDataCleaner.download_tables-282"><a href="#MicronsDataCleaner.download_tables-282"><span class="linenos">282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.download_tables-283"><a href="#MicronsDataCleaner.download_tables-283"><span class="linenos">283</span></a>
</span><span id="MicronsDataCleaner.download_tables-284"><a href="#MicronsDataCleaner.download_tables-284"><span class="linenos">284</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading custom tables: </span><span class="si">{</span><span class="n">table_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.download_tables-285"><a href="#MicronsDataCleaner.download_tables-285"><span class="linenos">285</span></a>        <span class="n">down</span><span class="o">.</span><span class="n">download_tables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/&quot;</span><span class="p">,</span>  <span class="n">table_names</span><span class="p">)</span> 
</span><span id="MicronsDataCleaner.download_tables-286"><a href="#MicronsDataCleaner.download_tables-286"><span class="linenos">286</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Custom tables download completed.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.download_tables-287"><a href="#MicronsDataCleaner.download_tables-287"><span class="linenos">287</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Downloads a user-specified list of tables.
This method allows for downloading an arbitrary list of tables from the
database, in addition to those specified by the download policy during
initialization.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>table_names: list[str]
    A list containing the exact names of the tables to be downloaded.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>None.
    This method does not return a value. It saves the downloaded tables
    as CSV files in the `raw` data directory.
</code></pre>
</div>


                            </div>
                            <div id="MicronsDataCleaner.download_synapse_data" class="classattr">
                                        <input id="MicronsDataCleaner.download_synapse_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">download_synapse_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">presynaptic_set</span>,</span><span class="param">	<span class="n">postsynaptic_set</span>,</span><span class="param">	<span class="n">neurs_per_steps</span><span class="o">=</span><span class="mi">500</span>,</span><span class="param">	<span class="n">start_index</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">max_retries</span><span class="o">=</span><span class="mi">10</span>,</span><span class="param">	<span class="n">delay</span><span class="o">=</span><span class="mi">5</span>,</span><span class="param">	<span class="n">drop_synapses_duplicates</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MicronsDataCleaner.download_synapse_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MicronsDataCleaner.download_synapse_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MicronsDataCleaner.download_synapse_data-290"><a href="#MicronsDataCleaner.download_synapse_data-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_synapse_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">presynaptic_set</span><span class="p">,</span> <span class="n">postsynaptic_set</span><span class="p">,</span> <span class="n">neurs_per_steps</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">start_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">drop_synapses_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="MicronsDataCleaner.download_synapse_data-291"><a href="#MicronsDataCleaner.download_synapse_data-291"><span class="linenos">291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.download_synapse_data-292"><a href="#MicronsDataCleaner.download_synapse_data-292"><span class="linenos">292</span></a><span class="sd">        Downloads synaptic connections between specified sets of neurons.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-293"><a href="#MicronsDataCleaner.download_synapse_data-293"><span class="linenos">293</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner.download_synapse_data-294"><a href="#MicronsDataCleaner.download_synapse_data-294"><span class="linenos">294</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner.download_synapse_data-295"><a href="#MicronsDataCleaner.download_synapse_data-295"><span class="linenos">295</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner.download_synapse_data-296"><a href="#MicronsDataCleaner.download_synapse_data-296"><span class="linenos">296</span></a><span class="sd">            presynaptic_set: numpy.ndarray</span>
</span><span id="MicronsDataCleaner.download_synapse_data-297"><a href="#MicronsDataCleaner.download_synapse_data-297"><span class="linenos">297</span></a><span class="sd">                A 1D NumPy array of unique `root_ids` for the presynaptic neurons.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-298"><a href="#MicronsDataCleaner.download_synapse_data-298"><span class="linenos">298</span></a><span class="sd">            postsynaptic_set: numpy.ndarray</span>
</span><span id="MicronsDataCleaner.download_synapse_data-299"><a href="#MicronsDataCleaner.download_synapse_data-299"><span class="linenos">299</span></a><span class="sd">                A 1D NumPy array of unique `root_ids` for the postsynaptic neurons.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-300"><a href="#MicronsDataCleaner.download_synapse_data-300"><span class="linenos">300</span></a><span class="sd">            neurs_per_steps: int, optional</span>
</span><span id="MicronsDataCleaner.download_synapse_data-301"><a href="#MicronsDataCleaner.download_synapse_data-301"><span class="linenos">301</span></a><span class="sd">                The number of postsynaptic neurons to query per batch, by default 500.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-302"><a href="#MicronsDataCleaner.download_synapse_data-302"><span class="linenos">302</span></a><span class="sd">                This is crucial for managing API query size and preventing crashes.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-303"><a href="#MicronsDataCleaner.download_synapse_data-303"><span class="linenos">303</span></a><span class="sd">            start_index: int, optional</span>
</span><span id="MicronsDataCleaner.download_synapse_data-304"><a href="#MicronsDataCleaner.download_synapse_data-304"><span class="linenos">304</span></a><span class="sd">                The batch index from which to start or resume the download, by default 0.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-305"><a href="#MicronsDataCleaner.download_synapse_data-305"><span class="linenos">305</span></a><span class="sd">                Set this to continue an interrupted download.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-306"><a href="#MicronsDataCleaner.download_synapse_data-306"><span class="linenos">306</span></a><span class="sd">            max_retries: int, optional</span>
</span><span id="MicronsDataCleaner.download_synapse_data-307"><a href="#MicronsDataCleaner.download_synapse_data-307"><span class="linenos">307</span></a><span class="sd">                The maximum number of times to retry a failed API query before</span>
</span><span id="MicronsDataCleaner.download_synapse_data-308"><a href="#MicronsDataCleaner.download_synapse_data-308"><span class="linenos">308</span></a><span class="sd">                raising an error, by default 10.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-309"><a href="#MicronsDataCleaner.download_synapse_data-309"><span class="linenos">309</span></a><span class="sd">            delay: int, optional</span>
</span><span id="MicronsDataCleaner.download_synapse_data-310"><a href="#MicronsDataCleaner.download_synapse_data-310"><span class="linenos">310</span></a><span class="sd">                The number of seconds to wait between retries if an API error occurs,</span>
</span><span id="MicronsDataCleaner.download_synapse_data-311"><a href="#MicronsDataCleaner.download_synapse_data-311"><span class="linenos">311</span></a><span class="sd">                by default 5.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-312"><a href="#MicronsDataCleaner.download_synapse_data-312"><span class="linenos">312</span></a><span class="sd">            drop_synapses_duplicates: bool, optional</span>
</span><span id="MicronsDataCleaner.download_synapse_data-313"><a href="#MicronsDataCleaner.download_synapse_data-313"><span class="linenos">313</span></a><span class="sd">                If True (default), all synapses between any two neurons are merged into a</span>
</span><span id="MicronsDataCleaner.download_synapse_data-314"><a href="#MicronsDataCleaner.download_synapse_data-314"><span class="linenos">314</span></a><span class="sd">                single entry, with `synapse_size` being the sum of individual sizes.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-315"><a href="#MicronsDataCleaner.download_synapse_data-315"><span class="linenos">315</span></a><span class="sd">                If False, each synapse is kept as a separate record.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-316"><a href="#MicronsDataCleaner.download_synapse_data-316"><span class="linenos">316</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner.download_synapse_data-317"><a href="#MicronsDataCleaner.download_synapse_data-317"><span class="linenos">317</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner.download_synapse_data-318"><a href="#MicronsDataCleaner.download_synapse_data-318"><span class="linenos">318</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner.download_synapse_data-319"><a href="#MicronsDataCleaner.download_synapse_data-319"><span class="linenos">319</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-320"><a href="#MicronsDataCleaner.download_synapse_data-320"><span class="linenos">320</span></a><span class="sd">                This method does not return a value. It saves the downloaded synapse</span>
</span><span id="MicronsDataCleaner.download_synapse_data-321"><a href="#MicronsDataCleaner.download_synapse_data-321"><span class="linenos">321</span></a><span class="sd">                tables as a series of CSV files in the `raw/synapses` directory.</span>
</span><span id="MicronsDataCleaner.download_synapse_data-322"><a href="#MicronsDataCleaner.download_synapse_data-322"><span class="linenos">322</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.download_synapse_data-323"><a href="#MicronsDataCleaner.download_synapse_data-323"><span class="linenos">323</span></a>       
</span><span id="MicronsDataCleaner.download_synapse_data-324"><a href="#MicronsDataCleaner.download_synapse_data-324"><span class="linenos">324</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Starting synapse data download.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.download_synapse_data-325"><a href="#MicronsDataCleaner.download_synapse_data-325"><span class="linenos">325</span></a>        <span class="n">down</span><span class="o">.</span><span class="n">connectome_constructor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">,</span> <span class="n">presynaptic_set</span><span class="p">,</span> <span class="n">postsynaptic_set</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/synapses&quot;</span><span class="p">,</span>
</span><span id="MicronsDataCleaner.download_synapse_data-326"><a href="#MicronsDataCleaner.download_synapse_data-326"><span class="linenos">326</span></a>                                   <span class="n">neurs_per_steps</span> <span class="o">=</span> <span class="n">neurs_per_steps</span><span class="p">,</span> <span class="n">start_index</span><span class="o">=</span><span class="n">start_index</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span> <span class="n">drop_synapses_duplicates</span><span class="o">=</span><span class="n">drop_synapses_duplicates</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.download_synapse_data-327"><a href="#MicronsDataCleaner.download_synapse_data-327"><span class="linenos">327</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Synapse data download completed.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.download_synapse_data-328"><a href="#MicronsDataCleaner.download_synapse_data-328"><span class="linenos">328</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Downloads synaptic connections between specified sets of neurons.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>presynaptic_set: numpy.ndarray
    A 1D NumPy array of unique `root_ids` for the presynaptic neurons.
postsynaptic_set: numpy.ndarray
    A 1D NumPy array of unique `root_ids` for the postsynaptic neurons.
neurs_per_steps: int, optional
    The number of postsynaptic neurons to query per batch, by default 500.
    This is crucial for managing API query size and preventing crashes.
start_index: int, optional
    The batch index from which to start or resume the download, by default 0.
    Set this to continue an interrupted download.
max_retries: int, optional
    The maximum number of times to retry a failed API query before
    raising an error, by default 10.
delay: int, optional
    The number of seconds to wait between retries if an API error occurs,
    by default 5.
drop_synapses_duplicates: bool, optional
    If True (default), all synapses between any two neurons are merged into a
    single entry, with `synapse_size` being the sum of individual sizes.
    If False, each synapse is kept as a separate record.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>None.
    This method does not return a value. It saves the downloaded synapse
    tables as a series of CSV files in the `raw/synapses` directory.
</code></pre>
</div>


                            </div>
                            <div id="MicronsDataCleaner.merge_synapses" class="classattr">
                                        <input id="MicronsDataCleaner.merge_synapses-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">merge_synapses</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">syn_table_name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MicronsDataCleaner.merge_synapses-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MicronsDataCleaner.merge_synapses"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MicronsDataCleaner.merge_synapses-331"><a href="#MicronsDataCleaner.merge_synapses-331"><span class="linenos">331</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">merge_synapses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syn_table_name</span><span class="p">):</span>
</span><span id="MicronsDataCleaner.merge_synapses-332"><a href="#MicronsDataCleaner.merge_synapses-332"><span class="linenos">332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.merge_synapses-333"><a href="#MicronsDataCleaner.merge_synapses-333"><span class="linenos">333</span></a><span class="sd">        Merges downloaded synapse data batches into a single CSV file.</span>
</span><span id="MicronsDataCleaner.merge_synapses-334"><a href="#MicronsDataCleaner.merge_synapses-334"><span class="linenos">334</span></a>
</span><span id="MicronsDataCleaner.merge_synapses-335"><a href="#MicronsDataCleaner.merge_synapses-335"><span class="linenos">335</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner.merge_synapses-336"><a href="#MicronsDataCleaner.merge_synapses-336"><span class="linenos">336</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner.merge_synapses-337"><a href="#MicronsDataCleaner.merge_synapses-337"><span class="linenos">337</span></a><span class="sd">            syn_table_name: str</span>
</span><span id="MicronsDataCleaner.merge_synapses-338"><a href="#MicronsDataCleaner.merge_synapses-338"><span class="linenos">338</span></a><span class="sd">                The name for the output file that will contain the merged synapse data.</span>
</span><span id="MicronsDataCleaner.merge_synapses-339"><a href="#MicronsDataCleaner.merge_synapses-339"><span class="linenos">339</span></a><span class="sd">                </span>
</span><span id="MicronsDataCleaner.merge_synapses-340"><a href="#MicronsDataCleaner.merge_synapses-340"><span class="linenos">340</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner.merge_synapses-341"><a href="#MicronsDataCleaner.merge_synapses-341"><span class="linenos">341</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner.merge_synapses-342"><a href="#MicronsDataCleaner.merge_synapses-342"><span class="linenos">342</span></a><span class="sd">            None.</span>
</span><span id="MicronsDataCleaner.merge_synapses-343"><a href="#MicronsDataCleaner.merge_synapses-343"><span class="linenos">343</span></a><span class="sd">                This method does not return a value. It saves the merged table to a file.</span>
</span><span id="MicronsDataCleaner.merge_synapses-344"><a href="#MicronsDataCleaner.merge_synapses-344"><span class="linenos">344</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.merge_synapses-345"><a href="#MicronsDataCleaner.merge_synapses-345"><span class="linenos">345</span></a>        
</span><span id="MicronsDataCleaner.merge_synapses-346"><a href="#MicronsDataCleaner.merge_synapses-346"><span class="linenos">346</span></a>        <span class="n">down</span><span class="o">.</span><span class="n">merge_connection_tables</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw&quot;</span><span class="p">,</span> <span class="n">syn_table_name</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.merge_synapses-347"><a href="#MicronsDataCleaner.merge_synapses-347"><span class="linenos">347</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Merges downloaded synapse data batches into a single CSV file.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>syn_table_name: str
    The name for the output file that will contain the merged synapse data.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>None.
    This method does not return a value. It saves the merged table to a file.
</code></pre>
</div>


                            </div>
                            <div id="MicronsDataCleaner.merge_table" class="classattr">
                                        <input id="MicronsDataCleaner.merge_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">merge_table</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">unit_table</span>,</span><span class="param">	<span class="n">new_table</span>,</span><span class="param">	<span class="n">columns</span>,</span><span class="param">	<span class="n">method</span><span class="o">=</span><span class="s1">&#39;nucleus_id&#39;</span>,</span><span class="param">	<span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MicronsDataCleaner.merge_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MicronsDataCleaner.merge_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MicronsDataCleaner.merge_table-350"><a href="#MicronsDataCleaner.merge_table-350"><span class="linenos">350</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">merge_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit_table</span><span class="p">,</span> <span class="n">new_table</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nucleus_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">):</span>
</span><span id="MicronsDataCleaner.merge_table-351"><a href="#MicronsDataCleaner.merge_table-351"><span class="linenos">351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.merge_table-352"><a href="#MicronsDataCleaner.merge_table-352"><span class="linenos">352</span></a><span class="sd">        Merges new columns from a source table into the main unit table.</span>
</span><span id="MicronsDataCleaner.merge_table-353"><a href="#MicronsDataCleaner.merge_table-353"><span class="linenos">353</span></a>
</span><span id="MicronsDataCleaner.merge_table-354"><a href="#MicronsDataCleaner.merge_table-354"><span class="linenos">354</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner.merge_table-355"><a href="#MicronsDataCleaner.merge_table-355"><span class="linenos">355</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner.merge_table-356"><a href="#MicronsDataCleaner.merge_table-356"><span class="linenos">356</span></a><span class="sd">            unit_table: pandas.DataFrame</span>
</span><span id="MicronsDataCleaner.merge_table-357"><a href="#MicronsDataCleaner.merge_table-357"><span class="linenos">357</span></a><span class="sd">                The primary DataFrame to which new columns will be added.</span>
</span><span id="MicronsDataCleaner.merge_table-358"><a href="#MicronsDataCleaner.merge_table-358"><span class="linenos">358</span></a><span class="sd">            new_table: pandas.DataFrame</span>
</span><span id="MicronsDataCleaner.merge_table-359"><a href="#MicronsDataCleaner.merge_table-359"><span class="linenos">359</span></a><span class="sd">                The source DataFrame from which to pull the new columns.</span>
</span><span id="MicronsDataCleaner.merge_table-360"><a href="#MicronsDataCleaner.merge_table-360"><span class="linenos">360</span></a><span class="sd">            columns: list[str] or None</span>
</span><span id="MicronsDataCleaner.merge_table-361"><a href="#MicronsDataCleaner.merge_table-361"><span class="linenos">361</span></a><span class="sd">                A list of column names from `new_table` to merge into `unit_table`.</span>
</span><span id="MicronsDataCleaner.merge_table-362"><a href="#MicronsDataCleaner.merge_table-362"><span class="linenos">362</span></a><span class="sd">                If None, all columns from `new_table` (except the join keys) are used.</span>
</span><span id="MicronsDataCleaner.merge_table-363"><a href="#MicronsDataCleaner.merge_table-363"><span class="linenos">363</span></a><span class="sd">            method: str </span>
</span><span id="MicronsDataCleaner.merge_table-364"><a href="#MicronsDataCleaner.merge_table-364"><span class="linenos">364</span></a><span class="sd">                How the tables will be compared to each other. If &#39;nucleus_id&#39; (default), the target_id </span>
</span><span id="MicronsDataCleaner.merge_table-365"><a href="#MicronsDataCleaner.merge_table-365"><span class="linenos">365</span></a><span class="sd">                is matched to the nucleus_id. If functional, the session, scan and unit_id are compared. </span>
</span><span id="MicronsDataCleaner.merge_table-366"><a href="#MicronsDataCleaner.merge_table-366"><span class="linenos">366</span></a><span class="sd">                If &#39;pt_root_id&#39;, merge by &#39;pt_root_id&#39;. This last option is not adviced, unless is the only index available.</span>
</span><span id="MicronsDataCleaner.merge_table-367"><a href="#MicronsDataCleaner.merge_table-367"><span class="linenos">367</span></a><span class="sd">            how: str</span>
</span><span id="MicronsDataCleaner.merge_table-368"><a href="#MicronsDataCleaner.merge_table-368"><span class="linenos">368</span></a><span class="sd">                Equivalent to Panda&#39;s how argument for the merge function. Only &#39;inner&#39; or &#39;left&#39; are allowed, since the </span>
</span><span id="MicronsDataCleaner.merge_table-369"><a href="#MicronsDataCleaner.merge_table-369"><span class="linenos">369</span></a><span class="sd">                new columns are always added into the nucleus table.</span>
</span><span id="MicronsDataCleaner.merge_table-370"><a href="#MicronsDataCleaner.merge_table-370"><span class="linenos">370</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner.merge_table-371"><a href="#MicronsDataCleaner.merge_table-371"><span class="linenos">371</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner.merge_table-372"><a href="#MicronsDataCleaner.merge_table-372"><span class="linenos">372</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner.merge_table-373"><a href="#MicronsDataCleaner.merge_table-373"><span class="linenos">373</span></a><span class="sd">            pandas.DataFrame</span>
</span><span id="MicronsDataCleaner.merge_table-374"><a href="#MicronsDataCleaner.merge_table-374"><span class="linenos">374</span></a><span class="sd">                The merged DataFrame with the newly added columns.</span>
</span><span id="MicronsDataCleaner.merge_table-375"><a href="#MicronsDataCleaner.merge_table-375"><span class="linenos">375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.merge_table-376"><a href="#MicronsDataCleaner.merge_table-376"><span class="linenos">376</span></a>        
</span><span id="MicronsDataCleaner.merge_table-377"><a href="#MicronsDataCleaner.merge_table-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_columns</span><span class="p">(</span><span class="n">unit_table</span><span class="p">,</span> <span class="n">new_table</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">how</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Merges new columns from a source table into the main unit table.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>unit_table: pandas.DataFrame
    The primary DataFrame to which new columns will be added.
new_table: pandas.DataFrame
    The source DataFrame from which to pull the new columns.
columns: list[str] or None
    A list of column names from `new_table` to merge into `unit_table`.
    If None, all columns from `new_table` (except the join keys) are used.
method: str 
    How the tables will be compared to each other. If 'nucleus_id' (default), the target_id 
    is matched to the nucleus_id. If functional, the session, scan and unit_id are compared. 
    If 'pt_root_id', merge by 'pt_root_id'. This last option is not adviced, unless is the only index available.
how: str
    Equivalent to Panda's how argument for the merge function. Only 'inner' or 'left' are allowed, since the 
    new columns are always added into the nucleus table.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>pandas.DataFrame
    The merged DataFrame with the newly added columns.
</code></pre>
</div>


                            </div>
                            <div id="MicronsDataCleaner.process_nucleus_data" class="classattr">
                                        <input id="MicronsDataCleaner.process_nucleus_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_nucleus_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">functional_data</span><span class="o">=</span><span class="s1">&#39;none&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MicronsDataCleaner.process_nucleus_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MicronsDataCleaner.process_nucleus_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MicronsDataCleaner.process_nucleus_data-380"><a href="#MicronsDataCleaner.process_nucleus_data-380"><span class="linenos">380</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_nucleus_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">functional_data</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">):</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-381"><a href="#MicronsDataCleaner.process_nucleus_data-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-382"><a href="#MicronsDataCleaner.process_nucleus_data-382"><span class="linenos">382</span></a><span class="sd">        Processes downloaded data to generate a final, annotated unit table.</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-383"><a href="#MicronsDataCleaner.process_nucleus_data-383"><span class="linenos">383</span></a><span class="sd">        It reads all previously downloaded nucleus-related tables (cell type,</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-384"><a href="#MicronsDataCleaner.process_nucleus_data-384"><span class="linenos">384</span></a><span class="sd">        proofreading, brain area, etc.), merges them sequentially, transforms</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-385"><a href="#MicronsDataCleaner.process_nucleus_data-385"><span class="linenos">385</span></a><span class="sd">        coordinates, performs cortical layer segmentation, and optionally</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-386"><a href="#MicronsDataCleaner.process_nucleus_data-386"><span class="linenos">386</span></a><span class="sd">        integrates functional data based on the chosen strategy.</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-387"><a href="#MicronsDataCleaner.process_nucleus_data-387"><span class="linenos">387</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner.process_nucleus_data-388"><a href="#MicronsDataCleaner.process_nucleus_data-388"><span class="linenos">388</span></a><span class="sd">        Parameters:</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-389"><a href="#MicronsDataCleaner.process_nucleus_data-389"><span class="linenos">389</span></a><span class="sd">        -----------</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-390"><a href="#MicronsDataCleaner.process_nucleus_data-390"><span class="linenos">390</span></a><span class="sd">            functional_data: {&#39;none&#39;, &#39;match&#39;, &#39;all&#39;, &#39;best_only&#39;}, optional</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-391"><a href="#MicronsDataCleaner.process_nucleus_data-391"><span class="linenos">391</span></a><span class="sd">                Specifies how to integrate functional data, by default &#39;none&#39;.</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-392"><a href="#MicronsDataCleaner.process_nucleus_data-392"><span class="linenos">392</span></a><span class="sd">                - &#39;none&#39;: No functional data is added.</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-393"><a href="#MicronsDataCleaner.process_nucleus_data-393"><span class="linenos">393</span></a><span class="sd">                - &#39;match&#39;: Adds columns (`session`, `scan_idx`, `functional_unit_id`)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-394"><a href="#MicronsDataCleaner.process_nucleus_data-394"><span class="linenos">394</span></a><span class="sd">                  to allow matching units with their corresponding functional scans.</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-395"><a href="#MicronsDataCleaner.process_nucleus_data-395"><span class="linenos">395</span></a><span class="sd">                - &#39;all&#39;: Merges functional data from all available scans for each unit,</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-396"><a href="#MicronsDataCleaner.process_nucleus_data-396"><span class="linenos">396</span></a><span class="sd">                  potentially resulting in multiple rows per unit.</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-397"><a href="#MicronsDataCleaner.process_nucleus_data-397"><span class="linenos">397</span></a><span class="sd">                - &#39;best_only&#39;: Merges data only from the scan with the highest</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-398"><a href="#MicronsDataCleaner.process_nucleus_data-398"><span class="linenos">398</span></a><span class="sd">                  performance metric (`cc_abs`) for each unit.</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-399"><a href="#MicronsDataCleaner.process_nucleus_data-399"><span class="linenos">399</span></a><span class="sd">        </span>
</span><span id="MicronsDataCleaner.process_nucleus_data-400"><a href="#MicronsDataCleaner.process_nucleus_data-400"><span class="linenos">400</span></a><span class="sd">        Returns:</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-401"><a href="#MicronsDataCleaner.process_nucleus_data-401"><span class="linenos">401</span></a><span class="sd">        --------</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-402"><a href="#MicronsDataCleaner.process_nucleus_data-402"><span class="linenos">402</span></a><span class="sd">            nucleus_merged: pandas.DataFrame</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-403"><a href="#MicronsDataCleaner.process_nucleus_data-403"><span class="linenos">403</span></a><span class="sd">                The primary, processed unit table with all annotations, including</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-404"><a href="#MicronsDataCleaner.process_nucleus_data-404"><span class="linenos">404</span></a><span class="sd">                cell type, proofreading status, brain area, cortical layer, and</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-405"><a href="#MicronsDataCleaner.process_nucleus_data-405"><span class="linenos">405</span></a><span class="sd">                optionally functional properties.</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-406"><a href="#MicronsDataCleaner.process_nucleus_data-406"><span class="linenos">406</span></a><span class="sd">            segments: pandas.DataFrame</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-407"><a href="#MicronsDataCleaner.process_nucleus_data-407"><span class="linenos">407</span></a><span class="sd">                A DataFrame detailing the calculated cortical layer segments,</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-408"><a href="#MicronsDataCleaner.process_nucleus_data-408"><span class="linenos">408</span></a><span class="sd">                including their start and end coordinates.</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-409"><a href="#MicronsDataCleaner.process_nucleus_data-409"><span class="linenos">409</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-410"><a href="#MicronsDataCleaner.process_nucleus_data-410"><span class="linenos">410</span></a>        
</span><span id="MicronsDataCleaner.process_nucleus_data-411"><a href="#MicronsDataCleaner.process_nucleus_data-411"><span class="linenos">411</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing nucleus data with functional data option: &#39;</span><span class="si">{</span><span class="n">functional_data</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-412"><a href="#MicronsDataCleaner.process_nucleus_data-412"><span class="linenos">412</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-413"><a href="#MicronsDataCleaner.process_nucleus_data-413"><span class="linenos">413</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-414"><a href="#MicronsDataCleaner.process_nucleus_data-414"><span class="linenos">414</span></a>            <span class="c1"># Read all the downloaded data</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-415"><a href="#MicronsDataCleaner.process_nucleus_data-415"><span class="linenos">415</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Reading downloaded data files.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-416"><a href="#MicronsDataCleaner.process_nucleus_data-416"><span class="linenos">416</span></a>            <span class="n">nucleus</span>   <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;nucleus&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-417"><a href="#MicronsDataCleaner.process_nucleus_data-417"><span class="linenos">417</span></a>            <span class="n">celltype</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;celltype&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-418"><a href="#MicronsDataCleaner.process_nucleus_data-418"><span class="linenos">418</span></a>            <span class="n">proofread</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;proofreading&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-419"><a href="#MicronsDataCleaner.process_nucleus_data-419"><span class="linenos">419</span></a>            <span class="n">areas</span>     <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;brain_areas&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-420"><a href="#MicronsDataCleaner.process_nucleus_data-420"><span class="linenos">420</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-421"><a href="#MicronsDataCleaner.process_nucleus_data-421"><span class="linenos">421</span></a>            <span class="c1"># Use a better index for the global id</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-422"><a href="#MicronsDataCleaner.process_nucleus_data-422"><span class="linenos">422</span></a>            <span class="n">nucleus</span> <span class="o">=</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span> <span class="p">:</span> <span class="s1">&#39;nucleus_id&#39;</span><span class="p">})</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-423"><a href="#MicronsDataCleaner.process_nucleus_data-423"><span class="linenos">423</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-424"><a href="#MicronsDataCleaner.process_nucleus_data-424"><span class="linenos">424</span></a>            <span class="c1"># Load functional data depending on user preferences</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-425"><a href="#MicronsDataCleaner.process_nucleus_data-425"><span class="linenos">425</span></a>            <span class="k">if</span> <span class="n">functional_data</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;best_only&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]:</span> 
</span><span id="MicronsDataCleaner.process_nucleus_data-426"><a href="#MicronsDataCleaner.process_nucleus_data-426"><span class="linenos">426</span></a>                <span class="n">funcprops</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;func_props&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-427"><a href="#MicronsDataCleaner.process_nucleus_data-427"><span class="linenos">427</span></a>            <span class="k">elif</span> <span class="n">functional_data</span> <span class="o">==</span> <span class="s1">&#39;match&#39;</span><span class="p">:</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-428"><a href="#MicronsDataCleaner.process_nucleus_data-428"><span class="linenos">428</span></a>                <span class="n">coreg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_storage</span><span class="si">}</span><span class="s2">/raw/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;coreg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-429"><a href="#MicronsDataCleaner.process_nucleus_data-429"><span class="linenos">429</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-430"><a href="#MicronsDataCleaner.process_nucleus_data-430"><span class="linenos">430</span></a>            <span class="c1"># Call all the merge functions. First, cell types</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-431"><a href="#MicronsDataCleaner.process_nucleus_data-431"><span class="linenos">431</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Merging nucleus data with cell types.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-432"><a href="#MicronsDataCleaner.process_nucleus_data-432"><span class="linenos">432</span></a>            <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_nucleus_with_cell_types</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">celltype</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-433"><a href="#MicronsDataCleaner.process_nucleus_data-433"><span class="linenos">433</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-434"><a href="#MicronsDataCleaner.process_nucleus_data-434"><span class="linenos">434</span></a>            <span class="c1"># Then, brain area. </span>
</span><span id="MicronsDataCleaner.process_nucleus_data-435"><a href="#MicronsDataCleaner.process_nucleus_data-435"><span class="linenos">435</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Merging brain area information.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-436"><a href="#MicronsDataCleaner.process_nucleus_data-436"><span class="linenos">436</span></a>            <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_brain_area</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">,</span> <span class="n">areas</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-437"><a href="#MicronsDataCleaner.process_nucleus_data-437"><span class="linenos">437</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-438"><a href="#MicronsDataCleaner.process_nucleus_data-438"><span class="linenos">438</span></a>            <span class="c1"># Proofreading info</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-439"><a href="#MicronsDataCleaner.process_nucleus_data-439"><span class="linenos">439</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Merging proofreading status.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-440"><a href="#MicronsDataCleaner.process_nucleus_data-440"><span class="linenos">440</span></a>            <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_proofreading_status</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">,</span> <span class="n">proofread</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-441"><a href="#MicronsDataCleaner.process_nucleus_data-441"><span class="linenos">441</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-442"><a href="#MicronsDataCleaner.process_nucleus_data-442"><span class="linenos">442</span></a>            <span class="c1"># Get the correct positions</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-443"><a href="#MicronsDataCleaner.process_nucleus_data-443"><span class="linenos">443</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Transforming positions.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-444"><a href="#MicronsDataCleaner.process_nucleus_data-444"><span class="linenos">444</span></a>            <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">transform_positions</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-445"><a href="#MicronsDataCleaner.process_nucleus_data-445"><span class="linenos">445</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-446"><a href="#MicronsDataCleaner.process_nucleus_data-446"><span class="linenos">446</span></a>            <span class="c1"># Segment the data and add the information about layers</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-447"><a href="#MicronsDataCleaner.process_nucleus_data-447"><span class="linenos">447</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Segmenting volume and adding layer info.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-448"><a href="#MicronsDataCleaner.process_nucleus_data-448"><span class="linenos">448</span></a>            <span class="n">segments</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">divide_volume_into_segments</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-449"><a href="#MicronsDataCleaner.process_nucleus_data-449"><span class="linenos">449</span></a>            <span class="n">segments</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_segments_by_layer</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-450"><a href="#MicronsDataCleaner.process_nucleus_data-450"><span class="linenos">450</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-451"><a href="#MicronsDataCleaner.process_nucleus_data-451"><span class="linenos">451</span></a>            <span class="n">proc</span><span class="o">.</span><span class="n">add_layer_info</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">,</span> <span class="n">segments</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-452"><a href="#MicronsDataCleaner.process_nucleus_data-452"><span class="linenos">452</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-453"><a href="#MicronsDataCleaner.process_nucleus_data-453"><span class="linenos">453</span></a>            <span class="c1"># Clean the resulting table by eliminating all multisoma objects. </span>
</span><span id="MicronsDataCleaner.process_nucleus_data-454"><a href="#MicronsDataCleaner.process_nucleus_data-454"><span class="linenos">454</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleaning table: removing multisoma objects and duplicates.&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-455"><a href="#MicronsDataCleaner.process_nucleus_data-455"><span class="linenos">455</span></a>            <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">nucleus_merged</span><span class="p">[</span><span class="n">nucleus_merged</span><span class="p">[</span><span class="s1">&#39;pt_root_id&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-456"><a href="#MicronsDataCleaner.process_nucleus_data-456"><span class="linenos">456</span></a>            <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">nucleus_merged</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;pt_root_id&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-457"><a href="#MicronsDataCleaner.process_nucleus_data-457"><span class="linenos">457</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-458"><a href="#MicronsDataCleaner.process_nucleus_data-458"><span class="linenos">458</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-459"><a href="#MicronsDataCleaner.process_nucleus_data-459"><span class="linenos">459</span></a>            <span class="c1"># Finally, functional properties. </span>
</span><span id="MicronsDataCleaner.process_nucleus_data-460"><a href="#MicronsDataCleaner.process_nucleus_data-460"><span class="linenos">460</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding functional information&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-461"><a href="#MicronsDataCleaner.process_nucleus_data-461"><span class="linenos">461</span></a>            <span class="k">if</span> <span class="n">functional_data</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;best_only&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]:</span> 
</span><span id="MicronsDataCleaner.process_nucleus_data-462"><a href="#MicronsDataCleaner.process_nucleus_data-462"><span class="linenos">462</span></a>                <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_functional_properties</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">,</span> <span class="n">funcprops</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">functional_data</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-463"><a href="#MicronsDataCleaner.process_nucleus_data-463"><span class="linenos">463</span></a>                <span class="n">nucleus_merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nucleus_merged</span><span class="p">[</span><span class="s1">&#39;tuning_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;tuning_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_matched&#39;</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-464"><a href="#MicronsDataCleaner.process_nucleus_data-464"><span class="linenos">464</span></a>            <span class="k">elif</span> <span class="n">functional_data</span> <span class="o">==</span> <span class="s1">&#39;match&#39;</span><span class="p">:</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-465"><a href="#MicronsDataCleaner.process_nucleus_data-465"><span class="linenos">465</span></a>                <span class="n">nucleus_merged</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">merge_functional_properties</span><span class="p">(</span><span class="n">nucleus_merged</span><span class="p">,</span> <span class="n">coreg</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">functional_data</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-466"><a href="#MicronsDataCleaner.process_nucleus_data-466"><span class="linenos">466</span></a>                <span class="n">nucleus_merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nucleus_merged</span><span class="p">[</span><span class="s1">&#39;tuning_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;tuning_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_matched&#39;</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-467"><a href="#MicronsDataCleaner.process_nucleus_data-467"><span class="linenos">467</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-468"><a href="#MicronsDataCleaner.process_nucleus_data-468"><span class="linenos">468</span></a>                <span class="n">nucleus_merged</span><span class="p">[</span><span class="s1">&#39;tuning_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_matched&#39;</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-469"><a href="#MicronsDataCleaner.process_nucleus_data-469"><span class="linenos">469</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-470"><a href="#MicronsDataCleaner.process_nucleus_data-470"><span class="linenos">470</span></a>            <span class="k">return</span> <span class="n">nucleus_merged</span><span class="p">,</span> <span class="n">segments</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-471"><a href="#MicronsDataCleaner.process_nucleus_data-471"><span class="linenos">471</span></a>
</span><span id="MicronsDataCleaner.process_nucleus_data-472"><a href="#MicronsDataCleaner.process_nucleus_data-472"><span class="linenos">472</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-473"><a href="#MicronsDataCleaner.process_nucleus_data-473"><span class="linenos">473</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Required data file not found: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-474"><a href="#MicronsDataCleaner.process_nucleus_data-474"><span class="linenos">474</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MicronsDataCleaner.process_nucleus_data-475"><a href="#MicronsDataCleaner.process_nucleus_data-475"><span class="linenos">475</span></a>            <span class="k">raise</span> <span class="n">e</span> 
</span></pre></div>


            <div class="docstring"><p>Processes downloaded data to generate a final, annotated unit table.
It reads all previously downloaded nucleus-related tables (cell type,
proofreading, brain area, etc.), merges them sequentially, transforms
coordinates, performs cortical layer segmentation, and optionally
integrates functional data based on the chosen strategy.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>functional_data: {'none', 'match', 'all', 'best_only'}, optional
    Specifies how to integrate functional data, by default 'none'.
    - 'none': No functional data is added.
    - 'match': Adds columns (`session`, `scan_idx`, `functional_unit_id`)
      to allow matching units with their corresponding functional scans.
    - 'all': Merges functional data from all available scans for each unit,
      potentially resulting in multiple rows per unit.
    - 'best_only': Merges data only from the scan with the highest
      performance metric (`cc_abs`) for each unit.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>nucleus_merged: pandas.DataFrame
    The primary, processed unit table with all annotations, including
    cell type, proofreading status, brain area, cortical layer, and
    optionally functional properties.
segments: pandas.DataFrame
    A DataFrame detailing the calculated cortical layer segments,
    including their start and end coordinates.
</code></pre>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>